<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Companies House PDF Downloader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        
        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            text-align: center;
            font-size: 32px;
        }
        
        .subtitle {
            color: #718096;
            text-align: center;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .api-note {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        
        .api-note a {
            color: #667eea;
            text-decoration: none;
        }
        
        .instructions {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            margin-left: 20px;
            color: #4a5568;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .instructions code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .download-btn {
            background: #48bb78;
        }
        
        .download-btn:hover {
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
        }
        
        .github-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #718096;
        }
        
        .github-link a {
            color: #667eea;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ Companies House PDF Downloader</h1>
        <p class="subtitle">Generate a Python script to download all PDFs for UK companies</p>
        
        <form id="downloadForm">
            <div class="form-group">
                <label for="companyName">Company Name</label>
                <input 
                    type="text" 
                    id="companyName" 
                    placeholder="e.g. Tesco PLC, Sainsbury's" 
                    required
                >
            </div>
            
            <div class="form-group">
                <label for="apiKey">Companies House API Key</label>
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="Your API key" 
                    value="22aefa40-ee9e-47c0-b40a-2dd3c03165c6"
                    required
                >
                <p class="api-note">
                    Need an API key? <a href="https://developer.company-information.service.gov.uk/get-started" target="_blank">Get one free here</a>
                </p>
            </div>
            
            <button type="submit" class="btn">
                Generate Download Script
            </button>
            
            <button type="button" class="btn download-btn" id="downloadBtn" style="display: none;">
                Download Python Script
            </button>
        </form>
        
        <div class="instructions">
            <h3>üìñ How to use:</h3>
            <ol>
                <li>Enter the company name above</li>
                <li>Click "Generate Download Script"</li>
                <li>Download the generated Python script</li>
                <li>Make sure you have Python and requests installed:
                    <br><code>pip install requests</code>
                </li>
                <li>Run the script:
                    <br><code>python companies_house_downloader.py</code>
                </li>
                <li>All PDFs will be downloaded to a folder named after the company</li>
            </ol>
        </div>
        
        <div class="github-link">
            <a href="https://github.com/mariaiontseva/Company-House-PDF-Downloader" target="_blank">View on GitHub</a>
        </div>
    </div>
    
    <script>
        let generatedScript = '';
        
        document.getElementById('downloadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const companyName = document.getElementById('companyName').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            
            // Generate the Python script
            generatedScript = `#!/usr/bin/env python3
"""
Companies House PDF Downloader
Generated for: ${companyName}
"""

import os
import sys
import time
import requests
from datetime import datetime

API_KEY = "${apiKey}"
COMPANY_NAME = "${companyName}"

def download_companies_house_pdfs():
    print(f"\\nüîç Searching for company: {COMPANY_NAME}")
    
    # Set up session with authentication
    session = requests.Session()
    session.auth = (API_KEY, '')
    
    try:
        # Search for company
        search_url = "https://api.companieshouse.gov.uk/search/companies"
        params = {"q": COMPANY_NAME, "items_per_page": 1}
        
        response = session.get(search_url, params=params)
        if response.status_code == 401:
            print("‚ùå Authentication failed. Please check your API key.")
            return
        
        response.raise_for_status()
        data = response.json()
        
        if not data.get("items"):
            print(f"‚ùå No company found with name: {COMPANY_NAME}")
            return
        
        company = data["items"][0]
        company_number = company["company_number"]
        actual_name = company["title"]
        
        print(f"‚úÖ Found company: {actual_name} (Number: {company_number})")
        
        # Get filing history
        print("üìã Fetching filing history...")
        filing_url = f"https://api.companieshouse.gov.uk/company/{company_number}/filing-history"
        response = session.get(filing_url, params={"items_per_page": 100})
        response.raise_for_status()
        
        filing_data = response.json()
        items = filing_data.get("items", [])
        
        if not items:
            print("‚ùå No filing history found")
            return
        
        print(f"üìÑ Found {len(items)} documents")
        
        # Create output directory
        safe_name = "".join(c for c in actual_name if c.isalnum() or c in (' ', '-', '_')).rstrip()
        output_dir = os.path.join("downloads", safe_name)
        os.makedirs(output_dir, exist_ok=True)
        
        print(f"üìÅ Saving to: {output_dir}")
        print("\\nüöÄ Starting downloads...\\n")
        
        downloaded = 0
        failed = 0
        
        # Download PDFs
        for i, item in enumerate(items, 1):
            links = item.get("links", {})
            doc_metadata_link = links.get("document_metadata")
            
            if doc_metadata_link:
                try:
                    # Get document URL
                    if doc_metadata_link.startswith('/'):
                        doc_url = f"https://api.companieshouse.gov.uk{doc_metadata_link}"
                    else:
                        doc_url = doc_metadata_link
                    
                    # Get document metadata
                    response = session.get(doc_url)
                    if response.status_code == 200:
                        # Download actual document
                        content_url = f"{doc_url}/content"
                        response = session.get(content_url, headers={"Accept": "application/pdf"})
                        
                        if response.status_code == 200:
                            # Generate filename
                            date = item.get("date", "unknown")
                            category = item.get("category", "doc")
                            desc = item.get("description", "document")[:50]
                            safe_desc = "".join(c for c in desc if c.isalnum() or c in (' ', '-', '_'))
                            filename = f"{date}_{category}_{safe_desc}.pdf"
                            
                            filepath = os.path.join(output_dir, filename)
                            with open(filepath, 'wb') as f:
                                f.write(response.content)
                            
                            downloaded += 1
                            print(f"‚úÖ [{i}/{len(items)}] Downloaded: {filename}")
                            time.sleep(0.5)  # Rate limiting
                        else:
                            failed += 1
                    else:
                        failed += 1
                        
                except Exception as e:
                    failed += 1
                    print(f"‚ùå [{i}/{len(items)}] Failed to download document: {str(e)}")
        
        print(f"\\n‚ú® Download complete!")
        print(f"üìä Summary: {downloaded} downloaded, {failed} failed")
        print(f"üìÅ Files saved to: {os.path.abspath(output_dir)}")
        
    except Exception as e:
        print(f"\\n‚ùå Error: {str(e)}")

if __name__ == "__main__":
    print("\\n" + "="*50)
    print("üè¢ Companies House PDF Downloader")
    print("="*50)
    
    if not API_KEY:
        print("‚ùå API key is required")
        sys.exit(1)
    
    download_companies_house_pdfs()
`;
            
            // Show download button
            document.getElementById('downloadBtn').style.display = 'block';
        });
        
        document.getElementById('downloadBtn').addEventListener('click', () => {
            // Create and download the file
            const blob = new Blob([generatedScript], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'companies_house_downloader.py';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        });
    </script>
</body>
</html>