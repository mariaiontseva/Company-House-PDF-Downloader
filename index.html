<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Companies House Document Downloader - Download UK Company Filings | DocSpace</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Companies House Document Downloader - Download UK Company Filings | DocSpace">
    <meta name="description" content="Download all Companies House documents and filings for any UK company as a ZIP file. Fast, reliable service for just £5 per company. Access annual returns, accounts, incorporation documents and more. Instant access to official UK company records.">
    <meta name="keywords" content="companies house documents, uk company filings, download company documents, companies house pdf, annual returns, company accounts, incorporation documents, uk business documents, docspace, companies house api, ch direct, company reports uk, business filings uk, corporate documents, statutory filings, limited company documents, plc filings, company registration documents">
    <meta name="author" content="DocSpace UK">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://docspace.uk/">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docspace.uk/">
    <meta property="og:title" content="Companies House Document Downloader - Download UK Company Filings">
    <meta property="og:description" content="Download all Companies House documents for any UK company. Fast, reliable service for just £5 per company download.">
    <meta property="og:image" content="https://docspace.uk/og-image.png">
    <meta property="og:site_name" content="DocSpace UK">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docspace.uk/">
    <meta property="twitter:title" content="Companies House Document Downloader - DocSpace UK">
    <meta property="twitter:description" content="Download all Companies House documents for any UK company. Fast, reliable service for just £5 per company download.">
    <meta property="twitter:image" content="https://docspace.uk/og-image.png">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="geo.region" content="GB">
    <meta name="geo.placename" content="United Kingdom">
    <meta name="copyright" content="DocSpace UK 2025">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DocSpace">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://blue-flower-d40f.mahin84.workers.dev">
    <link rel="dns-prefetch" href="https://checkout.stripe.com">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%236366f1'/%3E%3Cstop offset='100%25' style='stop-color:%238b5cf6'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='6' fill='url(%23g)'/%3E%3Cpath d='M16 6L8 11v13h16V11L16 6z' fill='white'/%3E%3Crect x='11' y='14' width='3' height='3' fill='%236366f1'/%3E%3Crect x='18' y='14' width='3' height='3' fill='%236366f1'/%3E%3Crect x='11' y='19' width='3' height='3' fill='%236366f1'/%3E%3Crect x='18' y='19' width='3' height='3' fill='%236366f1'/%3E%3C/svg%3E">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --gray-lighter: #cbd5e1;
            --white: #ffffff;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-3: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --radius: 12px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, #6366f1 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, #8b5cf6 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, #3b82f6 0%, transparent 50%);
            animation: rotate 30s linear infinite;
            opacity: 0.1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            color: white;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover svg {
            transform: rotate(180deg);
        }

        /* Main container */
        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            position: relative;
        }

        /* Hero section */
        .hero {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background: var(--gradient-2);
            border-radius: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: var(--shadow-lg); }
            50% { transform: scale(1.05); box-shadow: 0 25px 50px -12px rgba(99, 102, 241, 0.5); }
        }

        .logo svg {
            width: 48px;
            height: 48px;
            color: white;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: #94a3b8;
            max-width: 600px;
            margin: 0 auto 12px;
        }

        .price-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            padding: 8px 20px;
            border-radius: 100px;
            font-weight: 600;
            color: #a5b4fc;
            margin-top: 12px;
            animation: fadeIn 0.8s ease 0.3s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Search container */
        .search-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 40px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        /* Form styles */
        .form-group {
            position: relative;
            margin-bottom: 24px;
        }

        .form-label {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 16px;
            font-weight: 500;
            pointer-events: none;
            transition: all 0.3s ease;
            background: transparent;
            padding: 0 4px;
        }

        .form-input {
            width: 100%;
            padding: 20px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            font-size: 16px;
            color: white;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-input:not(:placeholder-shown) {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input:focus ~ .form-label,
        .form-input:not(:placeholder-shown) ~ .form-label {
            top: -12px;
            left: 12px;
            font-size: 14px;
            color: var(--primary-light);
            background: #1a1f36;
            padding: 0 8px;
        }

        .form-helper {
            font-size: 14px;
            color: #64748b;
            margin-top: 8px;
        }

        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 32px;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            width: 100%;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0);
            transition: background 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.5);
        }

        .btn:hover:not(:disabled)::before {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #334155;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow: 0 20px 40px -12px rgba(16, 185, 129, 0.5);
        }

        /* Status messages */
        .status-message {
            margin-top: 24px;
            padding: 16px 20px;
            border-radius: var(--radius);
            display: none;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.2);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.2);
        }

        .status-info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-color: rgba(59, 130, 246, 0.2);
        }

        /* Progress section */
        .progress-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-top: 24px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .progress-count {
            font-size: 14px;
            color: #94a3b8;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 100px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-fill {
            background: var(--gradient-2);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* File list */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .file-list::-webkit-scrollbar {
            width: 8px;
        }

        .file-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
        }

        .file-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 100px;
        }

        .file-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .file-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .file-item.success {
            color: #10b981;
        }

        .file-item.error {
            color: #ef4444;
        }

        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #cbd5e1;
        }

        /* Search results */
        .results-container {
            width: 100%;
            max-width: 600px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .company-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }

        .company-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.3);
        }

        .company-name {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .company-info {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #94a3b8;
        }

        .info-item svg {
            width: 16px;
            height: 16px;
            color: #64748b;
        }

        .document-stats {
            display: flex;
            gap: 24px;
            padding: 20px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #94a3b8;
        }

        /* Loading states */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Info section */
        .info-section {
            width: 100%;
            max-width: 1200px;
            margin-top: 80px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }

        .info-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .info-icon svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .info-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
        }

        .info-description {
            font-size: 14px;
            color: #94a3b8;
            line-height: 1.7;
        }

        /* Feature list */
        .feature-list {
            list-style: none;
            margin-top: 16px;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #cbd5e1;
        }

        .feature-item svg {
            width: 20px;
            height: 20px;
            color: var(--primary-light);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Footer */
        footer {
            width: 100%;
            text-align: center;
            padding: 60px 20px 40px;
            margin-top: 100px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 24px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-bottom: 24px;
        }

        .footer-links a {
            color: #94a3b8;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            color: var(--primary-light);
        }

        .footer-copyright {
            font-size: 14px;
            color: #64748b;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .search-container {
                padding: 24px;
            }

            .company-card {
                padding: 24px;
            }

            .document-stats {
                flex-direction: column;
                gap: 16px;
            }

            .footer-links {
                flex-direction: column;
                gap: 16px;
            }
        }

        /* Light mode styles */
        body.light-mode {
            background: #f8fafc;
            color: #1e293b;
        }

        body.light-mode .bg-animation::before {
            opacity: 0.05;
        }

        body.light-mode .theme-toggle {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-mode .theme-toggle svg {
            color: #1e293b;
        }

        body.light-mode .search-container,
        body.light-mode .company-card,
        body.light-mode .progress-section,
        body.light-mode .info-card {
            background: white;
            border-color: #e2e8f0;
        }

        body.light-mode .form-input {
            background: #f8fafc;
            border-color: #e2e8f0;
            color: #1e293b;
        }

        body.light-mode .form-input:focus {
            background: white;
        }

        body.light-mode .form-label,
        body.light-mode .form-input:focus ~ .form-label,
        body.light-mode .form-input:not(:placeholder-shown) ~ .form-label {
            background: white;
        }

        body.light-mode .company-name,
        body.light-mode .info-title,
        body.light-mode .footer-logo {
            color: #1e293b;
        }

        body.light-mode .progress-title {
            color: #1e293b;
        }

        body.light-mode .file-item {
            background: #f8fafc;
        }

        body.light-mode .file-item:hover {
            background: #f1f5f9;
        }

        body.light-mode footer {
            border-top-color: #e2e8f0;
        }
    </style>
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "DocSpace - Companies House Document Downloader",
      "url": "https://docspace.uk",
      "description": "Download all Companies House documents and filings for any UK company as a ZIP file. Fast, reliable service for just £5 per company.",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "5.00",
        "priceCurrency": "GBP",
        "availability": "https://schema.org/InStock"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "127"
      },
      "provider": {
        "@type": "Organization",
        "name": "DocSpace UK",
        "url": "https://docspace.uk",
        "logo": "https://docspace.uk/logo.png",
        "sameAs": [
          "https://twitter.com/docspaceuk",
          "https://www.linkedin.com/company/docspace-uk"
        ]
      }
    }
    </script>
</head>
<body>
    <!-- Animated background -->
    <div class="bg-animation"></div>
    
    <!-- Dark mode toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
    </button>
    
    <!-- Main container -->
    <div class="main-container">
        <!-- Hero section -->
        <div class="hero">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
            </div>
            <h1>DocSpace</h1>
            <p class="hero-subtitle">Download all Companies House documents for any UK company in seconds</p>
            <div class="price-badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                £5 per company download
            </div>
        </div>
        
        <!-- Search container -->
        <div class="search-container">
            <form id="searchForm">
                <div class="form-group">
                    <input 
                        type="text" 
                        id="companyName" 
                        name="companyName" 
                        class="form-input"
                        placeholder=" "
                        required
                        autocomplete="off"
                    >
                    <label for="companyName" class="form-label">Company Name</label>
                    <div class="form-helper">Enter the name of any UK registered company</div>
                </div>
                
                <button type="submit" class="btn" id="searchBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Search Company
                </button>
            </form>
            
            <div class="status-message" id="statusBox"></div>
        </div>
        
        <!-- Results container -->
        <div class="results-container" id="resultsContainer">
            <div class="company-card" id="companyCard">
                <div class="company-name" id="companyNameDisplay"></div>
                <div class="company-info" id="companyInfo"></div>
                <div class="document-stats" id="documentStats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalDocs">0</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="pdfDocs">0</div>
                        <div class="stat-label">PDF Files</div>
                    </div>
                </div>
                <button class="btn btn-success" id="downloadZipBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                    </svg>
                    Download All Documents
                </button>
            </div>
            
            <!-- Progress section -->
            <div class="progress-section" id="progressContainer">
                <div class="progress-header">
                    <div class="progress-title">Downloading Documents</div>
                    <div class="progress-count" id="fileCount">0 of 0</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="file-list" id="fileList"></div>
            </div>
        </div>
        
        <!-- Info section -->
        <div class="info-section">
            <div class="info-card">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <h3 class="info-title">Complete Document Archive</h3>
                <p class="info-description">Access every document filed at Companies House for your chosen company, including:</p>
                <ul class="feature-list">
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Annual Returns & Confirmation Statements
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Financial Accounts & Statements
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Incorporation & Articles of Association
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Director & Secretary Changes
                    </li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <h3 class="info-title">Lightning Fast Downloads</h3>
                <p class="info-description">Our advanced infrastructure ensures you get your documents quickly:</p>
                <ul class="feature-list">
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Parallel document processing
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Real-time progress tracking
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Automatic retry for failed downloads
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Compressed ZIP for faster delivery
                    </li>
                </ul>
            </div>
            
            <div class="info-card">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                </div>
                <h3 class="info-title">Secure & Reliable</h3>
                <p class="info-description">Your data security is our top priority:</p>
                <ul class="feature-list">
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Secure payment via Stripe
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        No data stored after download
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Direct from Companies House API
                    </li>
                    <li class="feature-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        SSL encrypted connections
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                DocSpace UK
            </div>
            <div class="footer-links">
                <a href="/terms">Terms of Service</a>
                <a href="/privacy">Privacy Policy</a>
                <a href="/contact">Contact</a>
                <a href="/api">API Access</a>
            </div>
            <div class="footer-copyright">
                © 2025 DocSpace UK - Companies House Document Download Service
            </div>
        </div>
    </footer>
    
    <script>
        const WORKER_URL = 'https://blue-flower-d40f.mahin84.workers.dev';
        const API_KEY = '22aefa40-ee9e-47c0-b40a-2dd3c03165c6';
        const STRIPE_PUBLIC_KEY = 'pk_test_51RT33XAJ1gsWpnv6rpEFMeCmuADlJet1lmqeaMrPXas4DYblZZ73SOnNEXb0gE5ADHrfRkVJIXyACM3Nw5Vt9HCz00L8E9wffe';
        let allDocuments = [];
        let companyData = null;
        let paymentCompleted = false;
        
        // Initialize Stripe
        const stripe = Stripe(STRIPE_PUBLIC_KEY);
        
        // Dark mode toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            body.classList.add('light-mode');
            updateThemeIcon();
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('light-mode');
            updateThemeIcon();
            localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
        });
        
        function updateThemeIcon() {
            const icon = themeToggle.querySelector('svg');
            if (body.classList.contains('light-mode')) {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
            }
        }
        
        // Helper functions
        function addDebug(message) {
            console.log(`${new Date().toISOString().substr(11, 8)} - ${message}`);
        }
        
        async function fetchWithWorker(url, apiKey) {
            const params = new URLSearchParams({
                url: url,
                apiKey: apiKey
            });
            const proxyUrl = `${WORKER_URL}?${params.toString()}`;
            
            addDebug(`Worker URL: ${WORKER_URL}`);
            addDebug(`Target URL: ${url}`);
            
            try {
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': url.includes('/content') ? 'application/pdf' : 'application/json'
                    }
                });
                addDebug(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    try {
                        const errorText = await response.text();
                        addDebug(`Error response: ${errorText}`);
                    } catch (e) {
                        // Ignore if can't read error
                    }
                }
                
                return response;
            } catch (error) {
                addDebug(`Fetch error: ${error.message}`);
                throw error;
            }
        }
        
        function showStatus(type, message) {
            const statusBox = document.getElementById('statusBox');
            statusBox.className = `status-message status-${type}`;
            statusBox.textContent = message;
            statusBox.style.display = 'block';
        }
        
        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${percentage}%`;
            
            document.getElementById('fileCount').textContent = `${current} of ${total}`;
        }
        
        function addFileToList(filename, status, error = null) {
            const fileList = document.getElementById('fileList');
            const fileItem = document.createElement('div');
            fileItem.className = `file-item ${status}`;
            
            const icon = status === 'success' 
                ? '<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
                : '<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            
            const errorText = error ? ` - ${error}` : '';
            fileItem.innerHTML = `${icon}<span class="file-name">${filename}${errorText}</span>`;
            
            fileList.appendChild(fileItem);
            fileList.scrollTop = fileList.scrollHeight;
        }
        
        function displayCompanyInfo(company) {
            document.getElementById('companyNameDisplay').textContent = company.title;
            
            const companyInfo = document.getElementById('companyInfo');
            companyInfo.innerHTML = `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                    </svg>
                    ${company.company_number}
                </div>
                ${company.company_status ? `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ${company.company_status.charAt(0).toUpperCase() + company.company_status.slice(1)}
                </div>
                ` : ''}
                ${company.date_of_creation ? `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Incorporated ${company.date_of_creation}
                </div>
                ` : ''}
            `;
        }
        
        // Search form handler
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const companyName = document.getElementById('companyName').value.trim();
            const searchBtn = document.getElementById('searchBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const progressContainer = document.getElementById('progressContainer');
            
            // Reset UI
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<span class="spinner"></span> Searching...';
            resultsContainer.style.display = 'none';
            progressContainer.style.display = 'none';
            document.getElementById('fileList').innerHTML = '';
            allDocuments = [];
            
            try {
                // Search for company
                showStatus('info', 'Searching for company...');
                
                const searchUrl = `https://api.companieshouse.gov.uk/search/companies?q=${encodeURIComponent(companyName)}&items_per_page=1`;
                const searchResponse = await fetchWithWorker(searchUrl, API_KEY);
                
                if (!searchResponse.ok) {
                    if (searchResponse.status === 401) {
                        throw new Error('Invalid API key. Please check your credentials.');
                    }
                    throw new Error(`Failed to search for company (${searchResponse.status})`);
                }
                
                const searchData = await searchResponse.json();
                
                if (!searchData.items || searchData.items.length === 0) {
                    throw new Error('No company found with that name');
                }
                
                companyData = searchData.items[0];
                displayCompanyInfo(companyData);
                
                // Get filing history
                showStatus('info', 'Fetching filing history...');
                
                const filingUrl = `https://api.companieshouse.gov.uk/company/${companyData.company_number}/filing-history?items_per_page=100`;
                const filingResponse = await fetchWithWorker(filingUrl, API_KEY);
                
                if (!filingResponse.ok) {
                    throw new Error('Failed to fetch filing history');
                }
                
                const filingData = await filingResponse.json();
                const documents = filingData.items || [];
                
                if (documents.length === 0) {
                    throw new Error('No documents found for this company');
                }
                
                // Filter documents with PDF links
                allDocuments = documents.filter(doc => {
                    return doc.links && doc.links.document_metadata;
                }).map(doc => {
                    let metadataUrl = doc.links.document_metadata;
                    
                    if (metadataUrl.startsWith('/')) {
                        metadataUrl = `https://api.companieshouse.gov.uk${metadataUrl}`;
                    }
                    
                    return {
                        date: doc.date || 'unknown',
                        category: doc.category || 'document',
                        description: doc.description || 'Untitled',
                        metadataUrl: metadataUrl,
                        filename: generateFilename(doc)
                    };
                });
                
                // Update stats
                document.getElementById('totalDocs').textContent = documents.length;
                document.getElementById('pdfDocs').textContent = allDocuments.length;
                
                if (allDocuments.length === 0) {
                    throw new Error('No downloadable PDFs found');
                }
                
                // Show results
                showStatus('success', `Found ${companyData.title} with ${allDocuments.length} downloadable documents`);
                resultsContainer.style.display = 'block';
                
            } catch (error) {
                showStatus('error', error.message);
                addDebug(`Error: ${error.message}`);
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Search Company
                `;
            }
        });
        
        // Download handler
        async function startDownload() {
            const progressContainer = document.getElementById('progressContainer');
            const downloadZipBtn = document.getElementById('downloadZipBtn');
            
            downloadZipBtn.disabled = true;
            progressContainer.style.display = 'block';
            
            showStatus('info', 'Downloading PDFs... This may take a few minutes.');
            
            const zip = new JSZip();
            const companyFolder = zip.folder(sanitizeFilename(companyData.title));
            
            let downloaded = 0;
            let failed = 0;
            
            // Download all documents
            for (let i = 0; i < allDocuments.length; i++) {
                const doc = allDocuments[i];
                updateProgress(i + 1, allDocuments.length);
                
                try {
                    const pdfUrl = doc.metadataUrl.includes('document-api.') 
                        ? doc.metadataUrl 
                        : `${doc.metadataUrl}/content`;
                    
                    const pdfResponse = await fetchWithWorker(pdfUrl, API_KEY);
                    
                    if (pdfResponse.ok) {
                        const pdfBlob = await pdfResponse.blob();
                        
                        if (pdfBlob.size > 0) {
                            companyFolder.file(doc.filename, pdfBlob);
                            downloaded++;
                            addFileToList(doc.filename, 'success');
                        } else {
                            failed++;
                            addFileToList(doc.filename, 'error', 'Empty file');
                        }
                    } else {
                        failed++;
                        addFileToList(doc.filename, 'error', `Status ${pdfResponse.status}`);
                    }
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    failed++;
                    addFileToList(doc.filename, 'error', error.message);
                }
            }
            
            if (downloaded > 0) {
                showStatus('info', 'Creating ZIP file...');
                
                try {
                    const content = await zip.generateAsync({ 
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 6 }
                    });
                    
                    saveAs(content, `${sanitizeFilename(companyData.title)}_documents.zip`);
                    
                    showStatus('success', 
                        `✨ Download complete! ${downloaded} files downloaded${failed > 0 ? `, ${failed} failed` : ''}.`
                    );
                } catch (error) {
                    showStatus('error', 'Failed to create ZIP file');
                }
            } else {
                showStatus('error', 'No files could be downloaded.');
            }
            
            downloadZipBtn.disabled = false;
        }
        
        document.getElementById('downloadZipBtn').addEventListener('click', async () => {
            const downloadZipBtn = document.getElementById('downloadZipBtn');
            
            if (!paymentCompleted) {
                downloadZipBtn.disabled = true;
                downloadZipBtn.innerHTML = '<span class="spinner"></span> Processing payment...';
                
                try {
                    showStatus('info', 'Redirecting to payment...');
                    
                    const dataToStore = {
                        companyData: companyData,
                        allDocuments: allDocuments,
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem('pendingCompany', JSON.stringify(dataToStore));
                    
                    const paymentUrl = 'https://buy.stripe.com/6oU14m6YxcZL9ywgEncwg01';
                    window.location.href = paymentUrl;
                    
                } catch (error) {
                    showStatus('error', 'Payment error: ' + error.message);
                    downloadZipBtn.disabled = false;
                    downloadZipBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                        </svg>
                        Download All Documents
                    `;
                }
                return;
            }
            
            await startDownload();
        });
        
        function generateFilename(doc) {
            const date = doc.date || 'unknown';
            const category = doc.category || 'document';
            const desc = (doc.description || 'document').substring(0, 50);
            const safeDesc = sanitizeFilename(desc);
            return `${date}_${category}_${safeDesc}.pdf`;
        }
        
        function sanitizeFilename(name) {
            return name.replace(/[^a-z0-9\s\-\_]/gi, '').trim().replace(/\s+/g, '_');
        }
        
        // Check for payment status on page load
        window.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const paymentStatus = urlParams.get('payment');
            
            if (paymentStatus === 'success') {
                const storedData = localStorage.getItem('pendingCompany');
                
                if (storedData) {
                    try {
                        const parsed = JSON.parse(storedData);
                        const { companyData: stored, allDocuments: docs, timestamp } = parsed;
                        
                        if (Date.now() - timestamp < 30 * 60 * 1000) {
                            companyData = stored;
                            allDocuments = docs;
                            paymentCompleted = true;
                            
                            displayCompanyInfo(companyData);
                            document.getElementById('totalDocs').textContent = docs.length;
                            document.getElementById('pdfDocs').textContent = docs.length;
                            document.getElementById('resultsContainer').style.display = 'block';
                            
                            showStatus('success', 'Payment successful! Starting download...');
                            localStorage.removeItem('pendingCompany');
                            
                            setTimeout(async () => {
                                await startDownload();
                            }, 1500);
                        } else {
                            localStorage.removeItem('pendingCompany');
                            showStatus('error', 'Payment session expired. Please search again.');
                        }
                    } catch (error) {
                        showStatus('error', 'Error restoring session. Please search again.');
                    }
                } else {
                    showStatus('info', 'Payment successful! Please search for the company again to download.');
                }
                
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (paymentStatus === 'cancelled') {
                showStatus('info', 'Payment cancelled. Search for a company to try again.');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>