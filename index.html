<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Companies House Bulk Download - Get All PDFs for £5 | DocSpace</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Companies House Bulk Download - Get All PDFs for £5 | DocSpace">
    <meta name="description" content="Download all Companies House documents instantly. Get every PDF filing for any UK company in one ZIP file. Official API, secure payment, £5 per company.">
    <meta name="keywords" content="companies house documents, uk company filings, download company documents, companies house pdf, annual returns, company accounts, incorporation documents, uk business documents, docspace, companies house api, ch direct, company reports uk, business filings uk, corporate documents, statutory filings, limited company documents, plc filings, company registration documents">
    <meta name="author" content="DocSpace UK">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://docspace.uk/">
    
    <!-- Web App Manifest -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2'%3E%3Cpath d='M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4'/%3E%3C/svg%3E">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docspace.uk/">
    <meta property="og:title" content="Companies House Bulk Download - Get All PDFs for £5">
    <meta property="og:description" content="Download all Companies House documents for any UK company. Fast, reliable service for just £5 per company download.">
    <!-- <meta property="og:image" content="https://docspace.uk/og-image.png"> -->
    <meta property="og:site_name" content="DocSpace UK">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docspace.uk/">
    <meta property="twitter:title" content="Companies House Bulk Download - Get All PDFs for £5">
    <meta property="twitter:description" content="Download all Companies House documents for any UK company. Fast, reliable service for just £5 per company download.">
    <!-- <meta property="twitter:image" content="https://docspace.uk/og-image.png"> -->
    
    <!-- Additional SEO Meta Tags -->
    <meta name="geo.region" content="GB">
    <meta name="geo.placename" content="United Kingdom">
    <meta name="copyright" content="DocSpace UK 2025">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DocSpace">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RR9SEE0SQF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RR9SEE0SQF');
    </script>
    
    <!-- FAQ Schema Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "How do I download all documents from Companies House?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Search for any UK company on DocSpace, pay £5, and instantly download all their Companies House documents as a ZIP file. Includes annual returns, accounts, incorporation documents, and more."
        }
      },{
        "@type": "Question",
        "name": "Can I bulk download Companies House PDFs?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! DocSpace lets you bulk download all Companies House PDFs for any UK company in one click. Get hundreds of documents instantly for just £5 per company."
        }
      },{
        "@type": "Question",
        "name": "How much does it cost to download Companies House documents?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "£5 per company for unlimited document downloads. This includes all filings, accounts, returns, and incorporation documents for that company."
        }
      },{
        "@type": "Question",
        "name": "Is DocSpace safe for downloading Companies House files?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, DocSpace uses the official Companies House API and Stripe for secure payments. All documents are authentic and sourced directly from Companies House."
        }
      }]
    }
    </script>
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://blue-flower-d40f.mahin84.workers.dev">
    <link rel="dns-prefetch" href="https://checkout.stripe.com">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%236366f1'/%3E%3Cstop offset='100%25' style='stop-color:%238b5cf6'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='6' fill='url(%23g)'/%3E%3Cpath d='M16 6L8 11v13h16V11L16 6z' fill='white'/%3E%3Crect x='11' y='14' width='3' height='3' fill='%236366f1'/%3E%3Crect x='18' y='14' width='3' height='3' fill='%236366f1'/%3E%3Crect x='11' y='19' width='3' height='3' fill='%236366f1'/%3E%3Crect x='18' y='19' width='3' height='3' fill='%236366f1'/%3E%3C/svg%3E">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --gray-lighter: #cbd5e1;
            --white: #ffffff;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-3: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --radius: 12px;
            --radius-lg: 16px;
        }
        
        /* Tab navigation */
        .tab-navigation {
            display: flex;
            gap: 4px;
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.03);
            padding: 4px;
            border-radius: 12px;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button:hover {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .coming-soon-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            font-size: 11px;
            font-weight: 600;
            border-radius: 100px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Explore tab content */
        .explore-content {
            text-align: center;
            padding: 40px 20px;
        }
        
        .explore-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: var(--gradient-2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);
        }
        
        .explore-icon svg {
            width: 40px;
            height: 40px;
            color: white;
        }
        
        .explore-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
        }
        
        .explore-description {
            font-size: 16px;
            color: #64748b;
            line-height: 1.6;
            max-width: 400px;
            margin: 0 auto;
        }
        
        /* Toast notification system */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        
        .toast {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease;
            pointer-events: all;
        }
        
        .toast.success {
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .toast.error {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .toast.info {
            border-color: rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .toast-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .toast.success .toast-icon {
            color: #10b981;
        }
        
        .toast.error .toast-icon {
            color: #ef4444;
        }
        
        .toast.info .toast-icon {
            color: #3b82f6;
        }
        
        .toast-message {
            flex: 1;
            font-size: 14px;
            color: white;
            line-height: 1.4;
        }
        
        .toast-close {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .toast-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Confetti styles */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }
        
        
        .confetti.square {
            border-radius: 0;
        }
        
        .confetti.circle {
            border-radius: 50%;
        }
        
        .confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid;
            background: none;
        }
        
        @keyframes confetti-burst {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(0.3) rotate(720deg);
                opacity: 0;
            }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--gradient-2);
            animation: confetti-burst 2s ease-out forwards;
            transform-origin: center;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, #6366f1 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, #8b5cf6 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, #3b82f6 0%, transparent 50%);
            animation: rotate 30s linear infinite;
            opacity: 0.1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Top bar */
        .top-bar {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            max-width: 1200px;
            margin: 0 auto;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
        }

        .logo-small {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 100px;
            padding: 8px 16px 8px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logo-small:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }
        
        .logo-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--gradient-2);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .logo-text {
            font-size: 15px;
            font-weight: 600;
            color: white;
            letter-spacing: -0.3px;
        }

        .logo-small:hover .logo-icon {
            transform: rotate(15deg);
        }

        .logo-icon svg {
            width: 18px;
            height: 18px;
            color: white;
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Create Account button */
        .create-account-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient-2);
            border: none;
            border-radius: 100px;
            padding: 10px 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .create-account-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.4);
        }

        .create-account-btn svg {
            width: 18px;
            height: 18px;
        }

        body.light-mode .create-account-btn {
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.3);
        }
        
        /* Profile mode - matching logo style exactly */
        .create-account-btn.profile-mode {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 100px;
            padding: 8px 16px 8px 8px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
        }
        
        .create-account-btn.profile-mode:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }
        
        .profile-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--gradient-2);
            border-radius: 50%;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }
        
        .create-account-btn.profile-mode:hover .profile-icon {
            transform: rotate(15deg);
        }
        
        .profile-text {
            font-size: 15px;
            font-weight: 600;
            color: white;
            letter-spacing: -0.3px;
        }
        
        /* Circle style for logged-in users */
        #userBtn.profile-mode {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #userBtn.profile-mode .profile-icon {
            width: 48px;
            height: 48px;
            background: none;
        }
        
        #userBtn.profile-mode svg {
            width: 24px;
            height: 24px;
            color: white;
        }
        
        #userBtn.profile-mode .profile-text {
            display: none;
        }
        
        }
        
        .profile-icon svg {
            width: 18px;
            height: 18px;
            color: white;
        }
        
        .create-account-btn.profile-mode:hover svg {
            color: white;
            transform: scale(1.1);
        }
        
        body.light-mode .create-account-btn.profile-mode {
            background: white;
            border-color: #e2e8f0;
            box-shadow: var(--shadow);
        }
        
        body.light-mode .create-account-btn.profile-mode svg {
            color: #6366f1;
        }
        
        /* Profile dropdown menu */
        .profile-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: rgba(20, 25, 40, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            min-width: 220px;
            padding: 8px;
            display: none;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            animation: dropdownFadeIn 0.2s ease;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .profile-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            color: #e2e8f0;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .dropdown-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: white;
        }
        
        .dropdown-item svg {
            width: 18px;
            height: 18px;
            color: #94a3b8;
            transition: color 0.2s ease;
        }
        
        .dropdown-item:hover svg {
            color: var(--primary-light);
        }
        
        .dropdown-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }
        
        .dropdown-item.danger {
            color: #f87171;
        }
        
        .dropdown-item.danger svg {
            color: #f87171;
        }
        
        .dropdown-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
        }
        
        body.light-mode .profile-dropdown {
            background: white;
            border-color: #e2e8f0;
        }
        
        body.light-mode .dropdown-item {
            color: #475569;
        }
        
        body.light-mode .dropdown-item:hover {
            background: rgba(99, 102, 241, 0.08);
            color: #1e293b;
        }
        
        body.light-mode .dropdown-divider {
            background: #e2e8f0;
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: relative;
            top: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            color: white;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover svg {
            transform: rotate(180deg);
        }

        /* Main container */
        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            position: relative;
        }

        /* Hero section */
        .hero {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: #94a3b8;
            max-width: 600px;
            margin: 0 auto 12px;
        }
        
        h1.hero-subtitle {
            font-size: 32px;
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            max-width: 600px;
            margin: 0 auto 24px;
            line-height: 1.3;
            letter-spacing: -0.5px;
        }

        .price-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            padding: 8px 20px;
            border-radius: 100px;
            font-weight: 600;
            color: #a5b4fc;
            margin-top: 12px;
            animation: fadeIn 0.8s ease 0.3s both;
        }

        body.light-mode .price-badge {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            color: #6366f1;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Search container */
        .search-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            animation: fadeInUp 0.8s ease 0.2s both;
            position: relative;
            z-index: 500;
        }
        
        /* Modern search form */
        #searchForm {
            position: relative;
            width: 100%;
        }
        
        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            font-size: 16px;
            color: white;
            transition: all 0.3s ease;
            font-family: inherit;
            height: 56px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-input::placeholder {
            color: #64748b;
            opacity: 1;
        }

        .form-helper {
            font-size: 14px;
            color: #64748b;
            text-align: center;
            opacity: 0.8;
            margin-top: 20px;
        }

        /* Search button */
        .search-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 18px 32px;
            min-width: 140px;
            width: 140px;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            white-space: nowrap;
            flex-shrink: 0;
            height: 56px;
        }
        
        .search-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.5);
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Ensure button text is always visible */
        .search-btn span {
            display: inline-flex !important;
            align-items: center;
            gap: 6px;
            visibility: visible !important;
        }
        
        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 32px;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            width: 100%;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0);
            transition: background 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.5);
        }

        .btn:hover:not(:disabled)::before {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #334155;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow: 0 20px 40px -12px rgba(16, 185, 129, 0.5);
        }

        /* Status messages - hidden as we use toasts now */
        .status-message {
            display: none !important;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.2);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.2);
        }

        .status-info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-color: rgba(59, 130, 246, 0.2);
        }

        /* Progress section */
        .progress-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-top: 24px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }

        .progress-count {
            font-size: 14px;
            color: #94a3b8;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 100px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-fill {
            background: var(--gradient-2);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* File list */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .file-list::-webkit-scrollbar {
            width: 8px;
        }

        .file-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
        }

        .file-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 100px;
        }

        .file-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .file-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .file-item.success {
            color: #10b981;
        }

        .file-item.error {
            color: #ef4444;
        }

        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #cbd5e1;
        }

        /* Search results */
        .results-container {
            width: 100%;
            max-width: 600px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .company-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            padding-left: 36px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .company-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .company-name {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .company-info {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #94a3b8;
        }

        .info-item svg {
            width: 16px;
            height: 16px;
            color: #64748b;
        }

        .document-stats {
            display: flex;
            gap: 24px;
            padding: 20px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #94a3b8;
        }

        /* Loading states */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Info section */
        .info-section-single {
            width: 100%;
            max-width: 600px;
            margin: 24px auto 60px;
        }

        .info-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .info-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(99, 102, 241, 0.25);
        }

        .info-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 32px;
        }

        .info-column h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 16px;
        }

        .feature-list.compact {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .feature-list.compact .feature-item {
            padding: 12px 16px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 14px;
            display: block;
            transition: all 0.2s ease;
        }

        .feature-list.compact .feature-item:hover {
            background: rgba(99, 102, 241, 0.15);
            transform: translateX(4px);
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .user-item {
            font-size: 14px;
        }

        .user-item strong {
            color: #e2e8f0;
            display: block;
            margin-bottom: 4px;
            font-size: 15px;
        }

        .user-item p {
            color: #94a3b8;
            margin: 0;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .info-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .info-container {
                padding: 24px;
            }
            
            .search-container {
                padding: 24px;
            }
            
            .search-btn {
                padding: 16px 24px;
                border-radius: var(--radius);
            }
            
            .search-wrapper {
                gap: 8px;
            }
            
            /* Fix profile button on mobile */
            .create-account-btn.profile-mode {
                padding: 6px 12px 6px 6px;
                white-space: nowrap;
                min-height: 44px;
            }
            
            .profile-icon {
                width: 32px;
                height: 32px;
                margin: 0;
            }
            
            .profile-text {
                font-size: 14px;
            }
            
            /* Keep top bar fixed but ensure content isn't covered */
            .hero {
                padding-top: 80px;
            }
            
            h1.hero-subtitle {
                font-size: 26px;
            }
        }

        /* Old info card styles for compatibility */
        .info-section {
            display: none;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }

        .info-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .info-icon svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .info-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
        }

        .info-description {
            font-size: 14px;
            color: #94a3b8;
            line-height: 1.7;
        }

        /* Feature list */
        .feature-list {
            list-style: none;
            margin-top: 16px;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #cbd5e1;
        }

        .feature-item svg {
            width: 20px;
            height: 20px;
            color: var(--primary-light);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Footer */
        footer {
            width: 100%;
            text-align: center;
            padding: 60px 20px 40px;
            margin-top: 100px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 24px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-bottom: 24px;
        }

        .footer-links a {
            color: #94a3b8;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .footer-links a:hover {
            color: var(--primary-light);
        }

        .footer-copyright {
            font-size: 14px;
            color: #64748b;
        }


        /* Download Status Indicator */
        .download-status-indicator {
            margin-bottom: 12px;
        }

        .already-downloaded {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--success);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .already-downloaded svg {
            flex-shrink: 0;
        }

        /* Responsive design */
        
        /* Mobile-first improvements */
        @media (max-width: 480px) {
            /* Hero section for mobile */
            h1 {
                font-size: 2rem;
                line-height: 1.2;
            }

            .hero-subtitle {
                font-size: 1rem;
                padding: 0 16px;
            }

            /* Tagline badge mobile */
            .hero div div {
                font-size: 14px !important;
                padding: 10px 20px !important;
                margin-top: 16px !important;
            }

            /* Tab navigation - make touch-friendly */
            .tab-navigation {
                margin-bottom: 24px;
                padding: 6px;
            }
            
            .tab-button {
                padding: 14px 20px;
                font-size: 14px;
                min-height: 48px; /* Touch target size */
            }

            /* Search container - full width on mobile */
            .search-container {
                padding: 20px 16px;
                margin: 0 16px 32px 16px;
                max-width: calc(100% - 32px);
                width: calc(100% - 32px);
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
            }
            
            /* Results container - full width on mobile */
            .results-container {
                max-width: 100%;
                margin: 0;
                width: 100%;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
            }
            
            /* Tab content container - full width on mobile */
            .tab-content {
                width: 100%;
                max-width: 100%;
            }

            /* Search form improvements */
            .search-form {
                gap: 12px;
            }
            
            .search-wrapper {
                gap: 8px !important;
            }
            
            .autocomplete-wrapper {
                flex: 1 !important;
                min-width: 0 !important;
                width: calc(100% - 56px) !important;
                max-width: calc(100% - 56px) !important;
            }

            #companySearch {
                padding: 16px 20px;
                font-size: 16px; /* Prevent zoom on iOS */
                min-height: 48px;
            }

            .search-btn {
                padding: 0 !important;
                min-height: 48px !important;
                height: 48px !important;
                width: 48px !important;
                max-width: 48px !important;
                min-width: 48px !important;
                flex-shrink: 0 !important;
                font-size: 15px !important;
                box-sizing: border-box !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .search-btn span {
                display: none !important;
            }

            /* Filter controls - keep two-line layout on mobile */
            /* Removed vertical stacking to maintain desktop layout */

            /* Toggle buttons - larger touch targets */
            .toggle-btn {
                padding: 12px 20px;
                font-size: 14px;
                min-height: 44px;
                flex: 1;
            }

            /* Industry filter - better mobile sizing */
            #industryFilter {
                min-height: 44px;
                padding: 10px 14px;
                font-size: 14px;
            }

            /* Filter block - no padding on mobile */
            .tab-content > div:first-child {
                margin: 24px 0 !important;
            }
            
            /* Company cards - mobile optimized with no side padding */
            .company-card, .explore-company-card {
                padding: 20px 0;
                margin: 0 0 16px 0;
            }
            
            /* Company list container - full width on mobile */
            #companyListExplore {
                max-width: 100%;
            }

            /* Company card content */
            .company-card h3 {
                font-size: 18px;
                line-height: 1.3;
            }

            .company-details {
                font-size: 14px;
            }

            /* Load more button */
            .show-more-btn {
                margin: 24px 16px;
                padding: 16px 32px;
                min-height: 48px;
                font-size: 15px;
            }

            /* Footer improvements */
            .footer-links {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            /* Marketing block - same width as main block on mobile */
            .info-container {
                margin: 0 16px !important;
                width: calc(100% - 32px) !important;
                max-width: calc(100% - 32px) !important;
            }

            /* Active switch mobile improvements */
            .switch {
                width: 44px !important;
                height: 24px !important;
                -webkit-appearance: none;
                appearance: none;
                background: rgba(255,255,255,0.1);
            }
            
            .switch.active {
                background: #6366f1;
            }
            
            .switch::after {
                width: 18px !important;
                height: 18px !important;
                top: 3px !important;
                left: 3px !important;
            }
            
            .switch.active::after {
                -webkit-transform: translateX(20px);
                transform: translateX(20px);
            }

            /* Pricing info mobile */
            .search-container p {
                text-align: center !important;
                font-size: 15px;
            }

            /* Company status indicators */
            .status-indicator {
                width: 10px;
                height: 10px;
                margin-right: 8px;
            }

            /* Industry badges - better mobile sizing */
            .explore-company-card .industry-badge,
            .company-card .industry-badge {
                padding: 4px 8px;
                font-size: 11px;
                border-radius: 4px;
            }

            /* Ensure tap targets are accessible */
            .explore-company-card,
            .company-card {
                cursor: pointer;
                min-height: 80px;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }

            .explore-company-card:active,
            .company-card:active {
                transform: scale(0.98);
            }

            /* Better text hierarchy on mobile */
            .explore-company-card h3,
            .company-card h3 {
                margin-bottom: 8px;
                font-weight: 600;
            }

            .explore-company-card .company-details,
            .company-card .company-details {
                line-height: 1.4;
            }
            
            /* Safari-specific fixes */
            @supports (-webkit-touch-callout: none) {
                /* Fix for Safari width calculations */
                .main-container {
                    width: 100%;
                    padding: 40px 0;
                }
                
                .search-container,
                .info-container {
                    max-width: 100% !important;
                    margin: 0 16px 32px 16px !important;
                    width: calc(100% - 32px) !important;
                }
                
                .results-container,
                .tab-content {
                    max-width: 100% !important;
                    margin: 0 !important;
                    width: 100% !important;
                }
                
                /* Fix switch on Safari */
                .switch {
                    display: inline-block;
                    position: relative;
                    vertical-align: middle;
                }
            }
        }

        /* Tablet styles */
        @media (max-width: 768px) and (min-width: 481px) {
            .top-bar {
                width: calc(100% - 32px);
            }

            .create-account-btn span {
                display: none;
            }

            .create-account-btn {
                padding: 10px;
                width: 48px;
                height: 48px;
                justify-content: center;
            }

            h1 {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .search-container {
                padding: 28px 24px;
                margin: 0 24px 40px 24px;
                max-width: none;
            }

            .company-card, .explore-company-card {
                padding: 24px;
                margin: 0 24px 20px 24px;
            }

            .document-stats {
                flex-direction: column;
                gap: 16px;
            }

            .footer-links {
                flex-direction: column;
                gap: 16px;
            }

            /* Filter controls - better spacing on tablet */
            .tab-content > div:first-child {
                flex-wrap: wrap;
                gap: 12px;
            }

            #industryFilter {
                min-width: 200px;
                flex-shrink: 0;
            }
        }

        /* Autocomplete styles */
        .autocomplete-wrapper {
            position: relative;
            width: 100%;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: rgba(20, 25, 40, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
        }

        /* Mobile autocomplete improvements */
        @media (max-width: 480px) {
            .autocomplete-dropdown {
                max-height: 250px;
                border-radius: 12px;
            }
            
            .autocomplete-item {
                padding: 16px;
                min-height: 48px;
            }
            
            .autocomplete-item .company-title {
                font-size: 16px;
                margin-bottom: 6px;
            }
            
            .autocomplete-item .company-details {
                font-size: 14px;
                flex-direction: column;
                gap: 4px;
                align-items: flex-start;
            }
        }

        .autocomplete-dropdown.show {
            display: block;
        }

        .autocomplete-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.active {
            background: rgba(99, 102, 241, 0.2);
        }

        .autocomplete-item .company-title {
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
            font-size: 15px;
        }

        .autocomplete-item .company-details {
            font-size: 13px;
            color: #94a3b8;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .autocomplete-item .company-number {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .autocomplete-item .company-status {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .autocomplete-item .company-status.active {
            color: #10b981;
        }

        .autocomplete-item .company-status.dissolved {
            color: #ef4444;
        }

        .autocomplete-loading {
            padding: 20px;
            text-align: center;
            color: #94a3b8;
        }

        .autocomplete-loading .spinner {
            margin: 0 auto;
        }

        .autocomplete-empty {
            padding: 20px;
            text-align: center;
            color: #64748b;
            font-size: 14px;
        }

        /* Light mode autocomplete */
        body.light-mode .autocomplete-dropdown {
            background: white;
            border-color: #e2e8f0;
        }

        body.light-mode .autocomplete-item {
            border-bottom-color: #f1f5f9;
        }

        body.light-mode .autocomplete-item:hover,
        body.light-mode .autocomplete-item.active {
            background: rgba(99, 102, 241, 0.08);
        }

        body.light-mode .autocomplete-item .company-title {
            color: #1e293b;
        }

        /* Light mode styles */
        body.light-mode {
            background: #f8fafc;
            color: #1e293b;
        }

        body.light-mode .bg-animation::before {
            opacity: 0.05;
        }

        body.light-mode .theme-toggle {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-mode .theme-toggle svg {
            color: #1e293b;
        }

        body.light-mode .search-container,
        body.light-mode .company-card,
        body.light-mode .progress-section,
        body.light-mode .info-container {
            background: white;
            border-color: #e2e8f0;
        }

        body.light-mode .info-column h3 {
            color: var(--primary);
        }

        body.light-mode .feature-list.compact .feature-item {
            background: rgba(99, 102, 241, 0.08);
            border-color: rgba(99, 102, 241, 0.15);
            color: #475569;
        }

        body.light-mode .feature-list.compact .feature-item:hover {
            background: rgba(99, 102, 241, 0.12);
        }

        body.light-mode .user-item strong {
            color: #1e293b;
        }

        body.light-mode .user-item p {
            color: #64748b;
        }

        body.light-mode .info-card {
            background: white;
            border-color: #e2e8f0;
        }

        body.light-mode .form-input {
            background: #f8fafc;
            border-color: #e2e8f0;
            color: #1e293b;
        }

        body.light-mode .form-input:focus {
            background: white;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        body.light-mode .company-name,
        body.light-mode .info-title,
        body.light-mode .footer-logo {
            color: #1e293b;
        }

        body.light-mode .progress-title {
            color: #1e293b;
        }

        body.light-mode .file-item {
            background: #f8fafc;
        }

        body.light-mode .file-item:hover {
            background: #f1f5f9;
        }

        body.light-mode footer {
            border-top-color: #e2e8f0;
        }
        /* Explore tab styles */
        .toggle-btn { 
            padding: 8px 16px; 
            background: rgba(255,255,255,0.05); 
            border: none;
            border-radius: 6px; 
            color: rgba(255,255,255,0.7); 
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .toggle-btn:hover {
            background: rgba(255,255,255,0.08);
            color: white;
        }
        .toggle-btn.active { 
            background: linear-gradient(135deg, #6366f1, #8b5cf6); 
            color: white;
        }
        .switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .switch.active {
            background: #6366f1;
        }
        .switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }
        .switch.active::after {
            transform: translateX(20px);
        }
        .explore-company-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 20px;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .explore-company-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(139,92,246,0.3);
            transform: translateY(-1px);
        }
        .status-indicator {
            width: 10px;
            height: 10px;
            min-width: 10px;
            min-height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
            position: relative;
            cursor: help;
            flex-shrink: 0;
        }
        .status-indicator::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        .status-indicator:hover::after {
            opacity: 1;
        }
        .status-active {
            background: #22c55e;
        }
        .status-dissolved {
            background: #6b7280;
        }
        .status-liquidation {
            background: #ef4444;
        }
        .status-dormant {
            background: #f59e0b;
        }
        .status-receivership {
            background: #dc2626;
        }
        .industry-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
        }
        .industry-agriculture {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        .industry-financial {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        .industry-technology {
            background: rgba(99, 102, 241, 0.15);
            color: #6366f1;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }
        .industry-transport {
            background: rgba(14, 165, 233, 0.15);
            color: #0ea5e9;
            border: 1px solid rgba(14, 165, 233, 0.3);
        }
        .industry-energy {
            background: rgba(251, 146, 60, 0.15);
            color: #fb923c;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }
        .industry-media {
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .industry-retail {
            background: rgba(236, 72, 153, 0.15);
            color: #ec4899;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        .industry-manufacturing {
            background: rgba(217, 70, 239, 0.15);
            color: #d946ef;
            border: 1px solid rgba(217, 70, 239, 0.3);
        }
        .industry-real.estate, .industry-real_estate {
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .industry-healthcare {
            background: rgba(34, 211, 238, 0.15);
            color: #22d3ee;
            border: 1px solid rgba(34, 211, 238, 0.3);
        }
        .industry-construction {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        .industry-services {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .industry-other {
            background: rgba(107, 114, 128, 0.15);
            color: #6b7280;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }
        
        /* Industry filter dropdown styles */
        #industryFilter {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        
        #industryFilter:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.1), 0 4px 6px -4px rgba(99, 102, 241, 0.1);
        }
        
        #industryFilter:focus {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-color: rgba(99, 102, 241, 0.6);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), 0 10px 15px -3px rgba(99, 102, 241, 0.1);
        }
        
        #industryFilter option {
            background: #1e293b;
            color: #e2e8f0;
            padding: 10px;
            font-weight: 500;
        }
        
        #industryFilter option:hover {
            background: #334155;
        }
        .show-more-btn {
            display: inline-block;
            padding: 12px 32px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
            margin: 0 auto;
        }
        .show-more-btn:hover {
            opacity: 0.9;
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
        }
        .show-more-btn:active {
            opacity: 0.8;
        }
    </style>
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "DocSpace - Companies House Document Downloader",
      "url": "https://docspace.uk",
      "description": "Download all Companies House documents and filings for any UK company as a ZIP file. Fast, reliable service for just £5 per company.",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "5.00",
        "priceCurrency": "GBP",
        "availability": "https://schema.org/InStock"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "127"
      },
      "provider": {
        "@type": "Organization",
        "name": "DocSpace UK",
        "url": "https://docspace.uk",
        "logo": "https://docspace.uk/",
        "sameAs": [
          "https://twitter.com/docspaceuk",
          "https://www.linkedin.com/company/docspace-uk"
        ]
      }
    }
    </script>
</head>
<body>
    <!-- Animated background -->
    <div class="bg-animation"></div>
    
    <!-- Top bar -->
    <div class="top-bar">
        <div class="logo-small" onclick="triggerLogoEffect()">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <span class="logo-text">DocSpace</span>
        </div>
        <div class="top-bar-actions">
            <!-- Auth button container with dropdown -->
            <div style="position: relative;">
                <!-- Guest button (shown when not logged in) -->
                <button class="create-account-btn profile-mode" id="guestBtn" aria-label="Account" style="display: flex;" onclick="document.getElementById('guestDropdown').classList.toggle('show')">
                    <div class="profile-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <span class="profile-text">Create Account</span>
                </button>
                
                <!-- User button (shown when logged in) -->
                <button class="create-account-btn profile-mode" id="userBtn" aria-label="Account" style="display: none;" onclick="document.getElementById('userDropdown').classList.toggle('show')">
                    <div class="profile-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </button>
                
                <!-- Guest dropdown -->
                <div class="profile-dropdown" id="guestDropdown">
                    <button class="dropdown-item" onclick="window.location.href='auth.html'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                        </svg>
                        Create Account
                    </button>
                    <button class="dropdown-item" onclick="window.location.href='auth.html?mode=signin'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Sign In
                    </button>
                    <!-- Light mode toggle commented out for now
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" onclick="toggleTheme()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                        <span id="themeText">Dark Mode</span>
                    </button>
                    -->
                </div>
                
                <!-- User dropdown -->
                <div class="profile-dropdown" id="userDropdown">
                    <button class="dropdown-item" onclick="alert('Companies I Follow - Coming soon!')">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                        Companies I Follow
                    </button>
                    <button class="dropdown-item" onclick="window.location.href='/search-history.html'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Search History
                    </button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item danger" onclick="signOut()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Log Out
                    </button>
                    <!-- Light mode toggle commented out for now
                    <button class="dropdown-item" onclick="toggleTheme()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                        <span id="themeTextUser">Dark Mode</span>
                    </button>
                    -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main container -->
    <div class="main-container">
        <!-- Hero section -->
        <div class="hero">
            <h1 class="hero-subtitle">Intelligently Explore and Export Companies House Data</h1>
            
            <!-- Tagline badge -->
            <div style="text-align: center; margin-top: 20px;">
                <div style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 50px; color: #a5b4fc; font-size: 16px; font-weight: 600;">
                    Get insights, automate the boring
                </div>
            </div>
        </div>
        
        <!-- Search container -->
        <div class="search-container">
            <!-- Tab navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('explore')">
                    Explore
                </button>
                <button class="tab-button" onclick="switchTab('search')">
                    Bulk PDF Download
                </button>
            </div>
            
            <!-- Search tab content -->
            <div class="tab-content" id="searchTab">
                <form id="searchForm">
                    <div class="search-wrapper">
                        <div class="autocomplete-wrapper" style="flex: 1; min-width: 0;">
                            <input 
                                type="text" 
                                id="companyName" 
                                name="companyName" 
                                class="form-input"
                                placeholder="Search UK companies by name or number"
                                required
                                autocomplete="off"
                            >
                            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                        </div>
                        <button type="submit" class="search-btn" id="searchBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <span>Search</span>
                        </button>
                    </div>
                    <!-- Subtle price info -->
                    <div style="text-align: left; margin-top: 8px; margin-bottom: 8px;">
                        <p style="color: #64748b; font-size: 14px; font-weight: 500; margin: 0; padding: 4px 0;">
                            Download all company PDFs for just 
                            <span style="color: #a5b4fc; font-weight: 600;">£5</span>
                        </p>
                    </div>
                </form>
            </div>
            
            <!-- Explore tab content -->
            <div class="tab-content active" id="exploreTab">
                <!-- Toggle buttons and filters -->
                <div style="display: flex; flex-direction: column; gap: 12px; margin: 24px 0;">
                    <!-- Line 1: Oldest, Newest, Active Only -->
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button class="toggle-btn active" onclick="showOldest()" id="oldestBtn">Oldest</button>
                        <button class="toggle-btn" onclick="showNewest()" id="newestBtn">Newest</button>
                        <div style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
                            <div class="switch" onclick="toggleActive(this)" id="activeSwitch"></div>
                            <span style="color: #94a3b8; font-size: 13px;">Active Only</span>
                        </div>
                    </div>
                    
                    <!-- Line 2: Industry Filter (full width) -->
                    <div style="width: 100%;">
                        <select id="industryFilter" onchange="onIndustryChange()" style="
                            width: 100%;
                            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
                            border: 1px solid rgba(99, 102, 241, 0.3);
                            color: #e2e8f0;
                            padding: 8px 16px 8px 12px;
                            padding-right: 36px;
                            border-radius: 10px;
                            font-size: 13px;
                            font-weight: 500;
                            cursor: pointer;
                            outline: none;
                            min-width: 180px;
                            appearance: none;
                            background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\"><path fill=\"%23a5b4fc\" d=\"M6 9L1 4h10z\"/></svg>');
                            background-repeat: no-repeat;
                            background-position: right 12px center;
                            transition: all 0.3s ease;
                            position: relative;
                        ">
                            <option value="ALL">🌐 All Industries</option>
                            <option value="AGRICULTURE">🌾 Agriculture</option>
                            <option value="FINANCIAL" selected>💰 Financial</option>
                            <option value="TECHNOLOGY">💻 Technology</option>
                            <option value="RETAIL">🛍️ Retail</option>
                            <option value="MANUFACTURING">🏭 Manufacturing</option>
                            <option value="REAL_ESTATE">🏢 Real Estate</option>
                            <option value="ENERGY">⚡ Energy</option>
                            <option value="HEALTHCARE">🏥 Healthcare</option>
                            <option value="TRANSPORT">🚚 Transport</option>
                            <option value="CONSTRUCTION">🏗️ Construction</option>
                            <option value="SERVICES">💼 Services</option>
                            <option value="MEDIA">📺 Media</option>
                            <option value="OTHER">📁 Other</option>
                        </select>
                    </div>
                </div>
                
                <!-- Company list -->
                <div id="companyListExplore"></div>
                
                <!-- Show more button -->
                <div style="text-align: center; margin-top: 24px; padding-bottom: 24px;">
                    <button class="show-more-btn" id="loadMoreBtn" onclick="loadMore()">Create Account for More</button>
                    <p style="color: #94a3b8; font-size: 14px; margin-top: 12px; margin-bottom: 0;">Get access to 5.6M UK Companies</p>
                </div>
            </div>
        </div>
        
        <!-- Toast container -->
        <div class="toast-container" id="toastContainer"></div>
        
        <!-- Results container -->
        <div class="results-container" id="resultsContainer">
            <div class="company-card" id="companyCard">
                <div class="company-name" id="companyNameDisplay"></div>
                <div class="company-info" id="companyInfo"></div>
                <div class="document-stats" id="documentStats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalDocs">0</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="companyAge">0</div>
                        <div class="stat-label">Years Old</div>
                    </div>
                </div>
                <button class="btn btn-success" id="downloadZipBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                    </svg>
                    Download All Documents
                </button>
            </div>
            
            <!-- Progress section -->
            <div class="progress-section" id="progressContainer">
                <div class="progress-header">
                    <div class="progress-title">Downloading Documents</div>
                    <div class="progress-count" id="fileCount">0 of 0</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="file-list" id="fileList"></div>
            </div>
        </div>
        
        <!-- Info section -->
        <div class="info-section-single" id="marketingSection">
            <div class="info-container">
                <div class="info-content">
                    <div class="info-column">
                        <h3 class="info-title">Why DocSpace?</h3>
                        <ul class="feature-list compact">
                            <li class="feature-item">All filings in one click</li>
                            <li class="feature-item">Blazing-fast downloads</li>
                            <li class="feature-item">Flat £5 fee per company</li>
                            <li class="feature-item">Secure Stripe checkout</li>
                            <li class="feature-item">No sign-up, no fuss</li>
                        </ul>
                    </div>
                    
                    <div class="info-column">
                        <h3 class="info-title">Who Uses DocSpace?</h3>
                        <div class="user-list">
                            <div class="user-item">
                                <strong>1. Accountants & Bookkeepers</strong>
                                <p>Quickly collect client filings for audits, tax prep, or financial reviews.</p>
                            </div>
                            <div class="user-item">
                                <strong>2. Corporate Investigators & Due Diligence Teams</strong>
                                <p>Download full company histories for M&A, compliance checks, or KYC.</p>
                            </div>
                            <div class="user-item">
                                <strong>3. Lawyers & Legal Researchers</strong>
                                <p>Access incorporation papers, director changes, charges—all in one go.</p>
                            </div>
                            <div class="user-item">
                                <strong>4. Investors & Analysts</strong>
                                <p>Evaluate company health and structure before investing or partnering.</p>
                            </div>
                            <div class="user-item">
                                <strong>5. Journalists & Researchers</strong>
                                <p>Get instant access to company disclosures for reports or case studies.</p>
                            </div>
                            <div class="user-item">
                                <strong>6. Founders & Business Owners</strong>
                                <p>Check competitor filings or retrieve your own archive easily.</p>
                            </div>
                            <div class="user-item">
                                <strong>7. Procurement & Risk Teams</strong>
                                <p>Vet suppliers with full filing history in seconds.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                DocSpace UK
            </div>
            <div class="footer-links">
                <a href="/terms">Terms of Service</a>
                <a href="/privacy">Privacy Policy</a>
                <a href="/contact">Contact</a>
                <a href="/api">API Access</a>
            </div>
            <div class="footer-copyright">
                © 2025 DocSpace UK - Companies House Document Download Service
            </div>
        </div>
    </footer>
    
    <script>
        const WORKER_URL = 'https://blue-flower-d40f.mahin84.workers.dev';
        const API_KEY = '22aefa40-ee9e-47c0-b40a-2dd3c03165c6';
        const STRIPE_PUBLIC_KEY = 'pk_test_51RT33XAJ1gsWpnv6rpEFMeCmuADlJet1lmqeaMrPXas4DYblZZ73SOnNEXb0gE5ADHrfRkVJIXyACM3Nw5Vt9HCz00L8E9wffe';
        let allDocuments = [];
        let companyData = null;
        let paymentCompleted = false;
        
        // Define menu functions early so they're available immediately
        function showUserMenu() {
            const dropdown = document.getElementById('profileDropdown');
            if (!dropdown) return;
            
            dropdown.innerHTML = `
                <button class="dropdown-item" onclick="showMonitoredCompanies()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                    Companies I Follow
                </button>
                <button class="dropdown-item" onclick="showSearchHistory()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Search History
                </button>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item danger" onclick="signOut()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Log Out
                </button>
            `;
            dropdown.classList.toggle('show');
        }
        
        function showGuestMenu() {
            const dropdown = document.getElementById('profileDropdown');
            if (!dropdown) return;
            
            dropdown.innerHTML = `
                <button class="dropdown-item" onclick="window.location.href='auth.html'">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                    </svg>
                    Create Account
                </button>
                <button class="dropdown-item" onclick="window.location.href='auth.html?mode=signin'">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Sign In
                </button>
            `;
            dropdown.classList.toggle('show');
        }
        
        function showMonitoredCompanies() {
            alert('Companies I Follow - Coming soon!');
        }
        
        function showSearchHistory() {
            window.location.href = '/search-history.html';
        }
        
        // Global auth button handler (simple version that doesn't need supabase)
        function handleAuthButtonClick(event) {
            event.preventDefault();
            event.stopPropagation();
            
            console.log('Auth button clicked!');
            
            // For now, just toggle the dropdown
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown) {
                // Simple toggle for testing
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                } else {
                    // Just show guest menu for now
                    showGuestMenu();
                }
            } else {
                console.error('Dropdown element not found!');
            }
        }
        
        // Initialize Stripe
        const stripe = Stripe(STRIPE_PUBLIC_KEY);
        
        // Autocomplete variables
        let autocompleteTimeout = null;
        let selectedIndex = -1;
        let suggestions = [];
        
        // Dark mode toggle - commented out for now
        /*
        const body = document.body;
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            body.classList.add('light-mode');
            updateThemeText();
        }
        
        function toggleTheme() {
            body.classList.toggle('light-mode');
            updateThemeText();
            localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
            // Close any open dropdowns
            document.getElementById('guestDropdown').classList.remove('show');
            document.getElementById('userDropdown').classList.remove('show');
        }
        
        function updateThemeText() {
            const themeText = document.getElementById('themeText');
            const themeTextUser = document.getElementById('themeTextUser');
            const newText = body.classList.contains('light-mode') ? 'Dark Mode' : 'Light Mode';
            if (themeText) themeText.textContent = newText;
            if (themeTextUser) themeTextUser.textContent = newText;
        }
        */
        
        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the correct tab button
            if (event && event.target) {
                event.target.closest('.tab-button').classList.add('active');
            } else {
                // When called programmatically, find the button by tabName
                document.querySelectorAll('.tab-button').forEach(btn => {
                    if ((tabName === 'search' && btn.textContent.includes('Search')) ||
                        (tabName === 'explore' && btn.textContent.includes('Explore'))) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'search') {
                document.getElementById('searchTab').classList.add('active');
            } else if (tabName === 'explore') {
                document.getElementById('exploreTab').classList.add('active');
                // Immediately render companies when explore tab is shown
                renderCompanies();
            }
        }
        
        // Logo click effect - confetti animation
        function triggerLogoEffect() {
            createConfetti();
            
            // Only reload if not on home page
            const isHomePage = window.location.pathname === '/' || 
                             window.location.pathname === '/index.html' ||
                             window.location.pathname === '';
            
            if (!isHomePage) {
                // Navigate to home page if on a different page
                setTimeout(() => {
                    window.location.href = '/';
                }, 3000);
            }
            // If on home page, just show confetti without reloading
        }
        
        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);
            
            // Get logo position
            const logo = document.querySelector('.logo-small');
            const logoRect = logo.getBoundingClientRect();
            const logoCenterX = logoRect.left + logoRect.width / 2;
            const logoCenterY = logoRect.top + logoRect.height / 2;
            
            const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
            const shapes = ['square', 'circle', 'triangle'];
            const confettiCount = 60;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                confetti.className = `confetti ${shape}`;
                
                // Random color
                const color = colors[Math.floor(Math.random() * colors.length)];
                if (shape === 'triangle') {
                    confetti.style.borderBottomColor = color;
                } else {
                    confetti.style.background = color;
                }
                
                // Position at logo center
                confetti.style.left = logoCenterX + 'px';
                confetti.style.top = logoCenterY + 'px';
                
                // Random burst direction
                const angle = (Math.PI * 2 * i) / confettiCount + (Math.random() - 0.5) * 0.5;
                const velocity = 200 + Math.random() * 400;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity - 100; // Slight upward bias
                
                confetti.style.setProperty('--x', vx + 'px');
                confetti.style.setProperty('--y', vy + 'px');
                
                // Random delay for staggered burst
                confetti.style.animationDelay = Math.random() * 0.2 + 's';
                
                // Random size
                const size = Math.random() * 8 + 6;
                if (shape !== 'triangle') {
                    confetti.style.width = size + 'px';
                    confetti.style.height = size + 'px';
                } else {
                    confetti.style.borderLeftWidth = (size/2) + 'px';
                    confetti.style.borderRightWidth = (size/2) + 'px';
                    confetti.style.borderBottomWidth = size + 'px';
                }
                
                container.appendChild(confetti);
            }
            
            // Add a flash effect on the logo
            logo.style.transform = 'scale(1.2)';
            logo.style.transition = 'transform 0.3s ease';
            setTimeout(() => {
                logo.style.transform = '';
            }, 300);
            
            // Clean up after animation
            setTimeout(() => {
                container.remove();
            }, 3000);
        }
        
        // Helper functions
        function addDebug(message) {
            console.log(`${new Date().toISOString().substr(11, 8)} - ${message}`);
        }
        
        async function fetchWithWorker(url, apiKey) {
            const params = new URLSearchParams({
                url: url,
                apiKey: apiKey
            });
            const proxyUrl = `${WORKER_URL}?${params.toString()}`;
            
            addDebug(`Worker URL: ${WORKER_URL}`);
            addDebug(`Target URL: ${url}`);
            
            try {
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': url.includes('/content') ? 'application/pdf' : 'application/json'
                    }
                });
                addDebug(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    try {
                        const errorText = await response.text();
                        addDebug(`Error response: ${errorText}`);
                    } catch (e) {
                        // Ignore if can't read error
                    }
                }
                
                return response;
            } catch (error) {
                addDebug(`Fetch error: ${error.message}`);
                throw error;
            }
        }
        
        // Toast notification system
        function showToast(type, message, duration = 5000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Icon based on type
            const icons = {
                success: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="toast-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
                error: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="toast-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
                info: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="toast-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
            };
            
            toast.innerHTML = `
                ${icons[type] || icons.info}
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        // Wrapper for old showStatus calls
        function showStatus(type, message) {
            showToast(type, message);
        }
        
        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${percentage}%`;
            
            document.getElementById('fileCount').textContent = `${current} of ${total}`;
        }
        
        function addFileToList(filename, status, error = null) {
            const fileList = document.getElementById('fileList');
            const fileItem = document.createElement('div');
            fileItem.className = `file-item ${status}`;
            
            const icon = status === 'success' 
                ? '<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
                : '<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            
            const errorText = error ? ` - ${error}` : '';
            fileItem.innerHTML = `${icon}<span class="file-name">${filename}${errorText}</span>`;
            
            fileList.appendChild(fileItem);
            fileList.scrollTop = fileList.scrollHeight;
        }
        
        async function displayCompanyInfo(company) {
            document.getElementById('companyNameDisplay').textContent = company.title;
            
            const companyInfo = document.getElementById('companyInfo');
            companyInfo.innerHTML = `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                    </svg>
                    ${company.company_number}
                </div>
                ${company.company_status ? `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ${company.company_status.charAt(0).toUpperCase() + company.company_status.slice(1)}
                </div>
                ` : ''}
                ${company.date_of_creation ? `
                <div class="info-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Incorporated ${company.date_of_creation}
                </div>
                ` : ''}
            `;
            
            // Check download status for authenticated users
            if (currentUser && window.searchHistory) {
                try {
                    const downloadStatus = await window.searchHistory.checkDownloadStatus(company.company_number);
                    const downloadBtn = document.getElementById('downloadZipBtn');
                    const downloadBtnContainer = downloadBtn.parentElement;
                    
                    if (downloadStatus && downloadStatus.download_status === 'downloaded') {
                        // Company already downloaded - show free re-download option
                        const downloadedDate = new Date(downloadStatus.downloaded_at).toLocaleDateString();
                        
                        // Add downloaded indicator
                        const existingIndicator = downloadBtnContainer.querySelector('.download-status-indicator');
                        if (existingIndicator) existingIndicator.remove();
                        
                        const indicator = document.createElement('div');
                        indicator.className = 'download-status-indicator';
                        indicator.innerHTML = `
                            <div class="already-downloaded">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="16" height="16">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                Already downloaded on ${downloadedDate}
                            </div>
                        `;
                        downloadBtnContainer.insertBefore(indicator, downloadBtn);
                        
                        // Update button text
                        downloadBtn.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Free Re-download
                        `;
                        downloadBtn.className = 'btn btn-primary'; // Change to green/primary color
                    } else {
                        // Company not downloaded yet - show normal download button
                        const existingIndicator = downloadBtnContainer.querySelector('.download-status-indicator');
                        if (existingIndicator) existingIndicator.remove();
                        
                        downloadBtn.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            Download All Documents
                        `;
                        downloadBtn.className = 'btn btn-success';
                    }
                } catch (error) {
                    console.error('Error checking download status:', error);
                }
            }
        }
        
        // Search form handler
        const searchForm = document.getElementById('searchForm');
        if (searchForm) {
            searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const companyInput = document.getElementById('companyName');
            const companyName = companyInput.value.trim();
            const companyNumber = companyInput.dataset.companyNumber; // Get stored company number
            const searchBtn = document.getElementById('searchBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const progressContainer = document.getElementById('progressContainer');
            
            // Reset UI
            searchBtn.disabled = true;
            const btnIcon = searchBtn.querySelector('svg');
            const btnText = searchBtn.querySelector('span');
            if (btnIcon && btnText) {
                btnIcon.style.display = 'none';
                btnText.innerHTML = '<span class="spinner"></span>';
                if (window.innerWidth > 480) {
                    btnText.innerHTML = '<span class="spinner"></span> Search';
                }
                btnText.style.visibility = 'visible';
            }
            resultsContainer.style.display = 'none';
            progressContainer.style.display = 'none';
            document.getElementById('fileList').innerHTML = '';
            allDocuments = [];
            
            // Clear the stored company number after use
            delete companyInput.dataset.companyNumber;
            
            try {
                // If we have a company number from autocomplete, fetch directly
                if (companyNumber) {
                        
                    const companyUrl = `https://api.companieshouse.gov.uk/company/${companyNumber}`;
                    const companyResponse = await fetchWithWorker(companyUrl, API_KEY);
                    
                    if (!companyResponse.ok) {
                        throw new Error(`Failed to fetch company details (${companyResponse.status})`);
                    }
                    
                    companyData = await companyResponse.json();
                    companyData.company_number = companyNumber; // Ensure number is set
                    companyData.title = companyData.company_name; // Normalize field name
                } else {
                    // Otherwise, search by name
                        
                    const searchUrl = `https://api.companieshouse.gov.uk/search/companies?q=${encodeURIComponent(companyName)}&items_per_page=1`;
                    const searchResponse = await fetchWithWorker(searchUrl, API_KEY);
                    
                    if (!searchResponse.ok) {
                        if (searchResponse.status === 401) {
                            throw new Error('Invalid API key. Please check your credentials.');
                        }
                        throw new Error(`Failed to search for company (${searchResponse.status})`);
                    }
                    
                    const searchData = await searchResponse.json();
                    
                    if (!searchData.items || searchData.items.length === 0) {
                        throw new Error('No company found with that name');
                    }
                    
                    companyData = searchData.items[0];
                }
                
                // Move search history saving to after document count is available
                
                await displayCompanyInfo(companyData);
                
                // Get filing history
                
                const filingUrl = `https://api.companieshouse.gov.uk/company/${companyData.company_number}/filing-history?items_per_page=100`;
                const filingResponse = await fetchWithWorker(filingUrl, API_KEY);
                
                if (!filingResponse.ok) {
                    throw new Error('Failed to fetch filing history');
                }
                
                const filingData = await filingResponse.json();
                const documents = filingData.items || [];
                
                if (documents.length === 0) {
                    throw new Error('No documents found for this company');
                }
                
                // Filter documents with PDF links
                allDocuments = documents.filter(doc => {
                    return doc.links && doc.links.document_metadata;
                }).map(doc => {
                    let metadataUrl = doc.links.document_metadata;
                    
                    if (metadataUrl.startsWith('/')) {
                        metadataUrl = `https://api.companieshouse.gov.uk${metadataUrl}`;
                    }
                    
                    return {
                        date: doc.date || 'unknown',
                        category: doc.category || 'document',
                        description: doc.description || 'Untitled',
                        metadataUrl: metadataUrl,
                        filename: generateFilename(doc)
                    };
                });
                
                // Update stats
                document.getElementById('totalDocs').textContent = documents.length;
                
                // Add to search history for logged-in users with file count
                if (window.searchHistory) {
                    try {
                        // Double-check auth state before saving
                        const { data: { user } } = await supabaseClient.auth.getUser();
                        if (user) {
                            const result = await window.searchHistory.addSearch(companyData, documents.length);
                            console.log('Search history add result:', result);
                            if (result) {
                                console.log('Successfully added to search history:', companyData.company_name, 'with', documents.length, 'documents');
                            } else {
                                console.log('Failed to add to search history - result is null/undefined');
                            }
                        } else {
                            console.log('User not logged in, skipping search history');
                        }
                    } catch (error) {
                        console.error('Failed to add to search history:', error);
                    }
                }
                
                // Calculate company age
                if (companyData.date_of_creation) {
                    const incorporationDate = new Date(companyData.date_of_creation);
                    const currentDate = new Date();
                    const ageInYears = Math.floor((currentDate - incorporationDate) / (365.25 * 24 * 60 * 60 * 1000));
                    document.getElementById('companyAge').textContent = ageInYears;
                } else {
                    document.getElementById('companyAge').textContent = 'N/A';
                }
                
                if (allDocuments.length === 0) {
                    throw new Error('No downloadable PDFs found');
                }
                
                // Show results
                showStatus('success', `Found ${companyData.title} with ${allDocuments.length} downloadable documents`);
                resultsContainer.style.display = 'block';
                
            } catch (error) {
                showStatus('error', error.message);
                addDebug(`Error: ${error.message}`);
            } finally {
                searchBtn.disabled = false;
                const btnIcon = searchBtn.querySelector('svg');
                const btnText = searchBtn.querySelector('span');
                if (btnIcon && btnText) {
                    btnIcon.style.display = '';
                    btnText.innerHTML = 'Search';
                    btnText.style.visibility = 'visible';
                }
            }
        });
        }
        
        // Download handler
        async function startDownload() {
            const progressContainer = document.getElementById('progressContainer');
            const downloadZipBtn = document.getElementById('downloadZipBtn');
            
            downloadZipBtn.disabled = true;
            progressContainer.style.display = 'block';
            
            const zip = new JSZip();
            const companyFolder = zip.folder(sanitizeFilename(companyData.title));
            
            let downloaded = 0;
            let failed = 0;
            
            // Download all documents
            for (let i = 0; i < allDocuments.length; i++) {
                const doc = allDocuments[i];
                updateProgress(i + 1, allDocuments.length);
                
                try {
                    // CRITICAL FIX: Always append /content to get actual PDF, not metadata
                    const contentUrl = `${doc.metadataUrl}/content`;
                    
                    const pdfResponse = await fetchWithWorker(contentUrl, API_KEY);
                    
                    if (pdfResponse.ok) {
                        const pdfBlob = await pdfResponse.blob();
                        
                        if (pdfBlob.size > 0) {
                            companyFolder.file(doc.filename, pdfBlob);
                            downloaded++;
                            addFileToList(doc.filename, 'success');
                        } else {
                            failed++;
                            addFileToList(doc.filename, 'error', 'Empty file');
                        }
                    } else {
                        failed++;
                        addFileToList(doc.filename, 'error', `Status ${pdfResponse.status}`);
                    }
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    failed++;
                    addFileToList(doc.filename, 'error', error.message);
                }
            }
            
            if (downloaded > 0) {
                try {
                    const content = await zip.generateAsync({ 
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 6 }
                    });
                    
                    saveAs(content, `${sanitizeFilename(companyData.title)}_documents.zip`);
                    
                    showStatus('success', 
                        `✨ Download complete! ${downloaded} files downloaded${failed > 0 ? `, ${failed} failed` : ''}.`
                    );
                } catch (error) {
                    showStatus('error', 'Failed to create ZIP file');
                }
            } else {
                showStatus('error', 'No files could be downloaded.');
            }
            
            downloadZipBtn.disabled = false;
        }
        
        const downloadBtn = document.getElementById('downloadZipBtn');
        if (downloadBtn) {
            downloadBtn.addEventListener('click', async () => {
            const downloadZipBtn = document.getElementById('downloadZipBtn');
            
            if (!paymentCompleted) {
                downloadZipBtn.disabled = true;
                downloadZipBtn.innerHTML = '<span class="spinner"></span> Processing payment...';
                
                try {
                    showStatus('info', 'Redirecting to payment...');
                    
                    const dataToStore = {
                        companyData: companyData,
                        allDocuments: allDocuments,
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem('pendingCompany', JSON.stringify(dataToStore));
                    
                    const paymentUrl = 'https://buy.stripe.com/6oU14m6YxcZL9ywgEncwg01';
                    window.location.href = paymentUrl;
                    
                } catch (error) {
                    showStatus('error', 'Payment error: ' + error.message);
                    downloadZipBtn.disabled = false;
                    downloadZipBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                        </svg>
                        Download All Documents
                    `;
                }
                return;
            }
            
            await startDownload();
        });
        }
        
        function generateFilename(doc) {
            const date = doc.date || 'unknown';
            const category = doc.category || 'document';
            const desc = (doc.description || 'document').substring(0, 50);
            const safeDesc = sanitizeFilename(desc);
            return `${date}_${category}_${safeDesc}.pdf`;
        }
        
        function sanitizeFilename(name) {
            return name.replace(/[^a-z0-9\s\-\_]/gi, '').trim().replace(/\s+/g, '_');
        }
        
        // Autocomplete functionality
        const companyInput = document.getElementById('companyName');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');
        
        if (!companyInput || !autocompleteDropdown) {
            console.log('Search form elements not found, skipping autocomplete setup');
            // Skip the rest of autocomplete setup if elements don't exist
        } else {
        
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Search companies for autocomplete
        async function searchCompanies(query) {
            if (query.length < 2) {
                hideAutocomplete();
                return;
            }
            
            // Show loading state
            autocompleteDropdown.innerHTML = '<div class="autocomplete-loading"><div class="spinner"></div></div>';
            autocompleteDropdown.classList.add('show');
            
            try {
                const searchUrl = `https://api.companieshouse.gov.uk/search/companies?q=${encodeURIComponent(query)}&items_per_page=5`;
                const response = await fetchWithWorker(searchUrl, API_KEY);
                
                if (!response.ok) {
                    hideAutocomplete();
                    return;
                }
                
                const data = await response.json();
                suggestions = data.items || [];
                
                if (suggestions.length === 0) {
                    autocompleteDropdown.innerHTML = '<div class="autocomplete-empty">No companies found</div>';
                    return;
                }
                
                // Render suggestions
                renderSuggestions();
                
            } catch (error) {
                console.error('Autocomplete error:', error);
                hideAutocomplete();
            }
        }
        
        // Render autocomplete suggestions
        function renderSuggestions() {
            autocompleteDropdown.innerHTML = suggestions.map((company, index) => {
                const statusClass = company.company_status === 'active' ? 'active' : 'dissolved';
                const statusIcon = company.company_status === 'active' 
                    ? '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="14" height="14"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
                    : '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="14" height="14"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                
                return `
                    <div class="autocomplete-item ${index === selectedIndex ? 'active' : ''}" data-index="${index}">
                        <div class="company-title">${company.title}</div>
                        <div class="company-details">
                            <span class="company-number">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="14" height="14">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                </svg>
                                ${company.company_number}
                            </span>
                            <span class="company-status ${statusClass}">
                                ${statusIcon}
                                ${company.company_status.charAt(0).toUpperCase() + company.company_status.slice(1)}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add click handlers
            const items = autocompleteDropdown.querySelectorAll('.autocomplete-item');
            items.forEach((item, index) => {
                item.addEventListener('click', () => selectCompany(index));
            });
        }
        
        // Select a company from autocomplete
        function selectCompany(index) {
            const company = suggestions[index];
            if (company) {
                companyInput.value = company.title;
                // Store the company number for exact search
                companyInput.dataset.companyNumber = company.company_number;
                hideAutocomplete();
                // Trigger search
                document.getElementById('searchForm').dispatchEvent(new Event('submit'));
            }
        }
        
        // Hide autocomplete dropdown
        function hideAutocomplete() {
            autocompleteDropdown.classList.remove('show');
            autocompleteDropdown.innerHTML = '';
            selectedIndex = -1;
            suggestions = [];
        }
        
        // Debounced search function
        const debouncedSearch = debounce(searchCompanies, 300);
        
        // Input event listener
        companyInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            if (query.length >= 2) {
                debouncedSearch(query);
            } else {
                hideAutocomplete();
            }
        });
        
        // Keyboard navigation
        companyInput.addEventListener('keydown', (e) => {
            if (!autocompleteDropdown.classList.contains('show')) return;
            
            switch (e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
                    renderSuggestions();
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    renderSuggestions();
                    break;
                    
                case 'Enter':
                    if (selectedIndex >= 0) {
                        e.preventDefault();
                        selectCompany(selectedIndex);
                    }
                    break;
                    
                case 'Escape':
                    hideAutocomplete();
                    break;
            }
        });
        
        // Hide autocomplete on click outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.autocomplete-wrapper')) {
                hideAutocomplete();
            }
        });
        
        } // End of autocomplete setup check
        
        // Initialize Supabase
        const SUPABASE_URL = 'https://iotwhyiisbazeqmowljv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvdHdoeWlpc2JhemVxbW93bGp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDUwMzUsImV4cCI6MjA2Mzg4MTAzNX0.HYAZLeIjR9b9C9k0p3wgf73GvpVH4-Ag9wQbACLcsLc';
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                persistSession: true,
                storageKey: 'docspace-auth',
                storage: window.localStorage,
                detectSessionInUrl: true,
                autoRefreshToken: true
            }
        });
        
        // Auth state management
        let currentUser = null;
        
        // Search history functions (inline since we can't import modules)
        window.searchHistory = {
            async addSearch(companyData, fileCount = null) {
                console.log('addSearch called with:', companyData, 'fileCount:', fileCount);
                
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    console.log('No user found in addSearch');
                    return null;
                }
                
                console.log('User found:', user.id, user.email);
                
                const recordData = {
                    user_id: user.id,
                    company_number: companyData.company_number,
                    company_name: companyData.company_name || companyData.title,
                    company_status: companyData.company_status,
                    company_type: companyData.company_type,
                    date_of_creation: companyData.date_of_creation,
                    address: companyData.registered_office_address ? 
                        `${companyData.registered_office_address.address_line_1 || ''}, ${companyData.registered_office_address.locality || ''}, ${companyData.registered_office_address.postal_code || ''}`.replace(/^,\s*|,\s*$/g, '') : 
                        null,
                    searched_at: new Date().toISOString()
                    // Note: file_count column doesn't exist in database yet
                };
                
                console.log('Attempting to upsert:', recordData);
                
                const { data, error } = await supabaseClient
                    .from('search_history')
                    .upsert(recordData)
                    .select();
                
                if (error) {
                    console.error('Error adding to search history:', error);
                    console.error('Error details:', error.message, error.details, error.hint);
                } else {
                    console.log('Successfully added to search history:', data);
                }
                
                return data;
            },

            async getHistory() {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return [];

                const { data, error } = await supabaseClient
                    .from('search_history')
                    .select('*')
                    .order('searched_at', { ascending: false })
                    .limit(20);

                if (error) {
                    console.error('Error getting search history:', error);
                    return [];
                }
                return data || [];
            },

            async checkDownloadStatus(companyNumber) {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return null;

                const { data, error } = await supabaseClient
                    .from('search_history')
                    .select('download_status, downloaded_at, company_name, download_count')
                    .eq('user_id', user.id)
                    .eq('company_number', companyNumber)
                    .maybeSingle();

                if (error && error.code !== 'PGRST116') console.error('Error checking download status:', error);
                return error ? null : data;
            }
        };
        
        // Listen for auth state changes
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth state changed:', event, session);
            currentUser = session?.user || null;
            updateAuthUI();
            
            // Special handling for sign in
            if (event === 'SIGNED_IN' && session) {
                console.log('User signed in successfully:', session.user.email);
                currentUser = session.user;
                updateAuthUI();
            }
        });
        
        // Force update auth UI immediately
        setTimeout(async () => {
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                console.log('Force session check:', { session, error });
                
                if (session) {
                    console.log('Force updating UI for logged in user:', session.user.email);
                    currentUser = session.user;
                    updateAuthUI();
                } else {
                    console.log('No session found in force update, trying refresh...');
                    // Try to refresh the session
                    const { data: refreshData, error: refreshError } = await supabaseClient.auth.refreshSession();
                    console.log('Refresh attempt:', { refreshData, refreshError });
                    
                    if (refreshData?.session) {
                        console.log('Session found after refresh:', refreshData.session.user.email);
                        currentUser = refreshData.session.user;
                        updateAuthUI();
                    } else {
                        console.log('No session after refresh either');
                    }
                }
            } catch (err) {
                console.error('Error in force update:', err);
            }
        }, 500);
        
        // Check auth state
        async function checkAuthState() {
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                console.log('Auth check - Session:', session);
                console.log('Auth check - User:', session?.user);
                if (error) {
                    console.error('Auth error:', error);
                }
                currentUser = session?.user || null;
                updateAuthUI();
            } catch (err) {
                console.error('Failed to check auth:', err);
            }
        }
        
        // Update UI based on auth state
        function updateAuthUI() {
            console.log('Updating auth UI, currentUser:', currentUser);
            const userBtn = document.getElementById('userBtn');
            const guestBtn = document.getElementById('guestBtn');
            const marketingSection = document.getElementById('marketingSection');
            
            if (currentUser) {
                console.log('User is logged in:', currentUser.email);
                // Show user button, hide guest button
                if (userBtn) userBtn.style.display = 'flex';
                if (guestBtn) guestBtn.style.display = 'none';
                
                // Hide marketing section for logged-in users
                if (marketingSection) {
                    marketingSection.style.display = 'none';
                }
            } else {
                console.log('User is not logged in');
                // Show guest button, hide user button
                if (guestBtn) guestBtn.style.display = 'flex';
                if (userBtn) userBtn.style.display = 'none';
                
                // Show marketing section for guests
                if (marketingSection) {
                    marketingSection.style.display = 'block';
                }
            }
        }
        
        // Show user dropdown menu
        function showUserMenu() {
            const dropdown = document.getElementById('profileDropdown');
            // Update dropdown content for logged-in users
            dropdown.innerHTML = `
                <button class="dropdown-item" onclick="showMonitoredCompanies()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                    </svg>
                    Companies I Follow
                </button>
                <button class="dropdown-item" onclick="showSearchHistory()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Search History
                </button>
                <button class="dropdown-item logout" onclick="signOut()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Log Out
                </button>
            `;
            dropdown.classList.toggle('show');
        }
        
        // Show guest dropdown menu
        function showGuestMenu() {
            const dropdown = document.getElementById('profileDropdown');
            // Update dropdown content for guests
            dropdown.innerHTML = `
                <button class="dropdown-item" onclick="window.location.href='auth.html'">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                    </svg>
                    Create Account
                </button>
                <button class="dropdown-item" onclick="window.location.href='auth.html?mode=signin'">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Sign In
                </button>
            `;
            dropdown.classList.toggle('show');
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            const userDropdown = document.getElementById('userDropdown');
            const guestDropdown = document.getElementById('guestDropdown');
            const userBtn = document.getElementById('userBtn');
            const guestBtn = document.getElementById('guestBtn');
            
            if (userDropdown && userBtn && !userBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.classList.remove('show');
            }
            
            if (guestDropdown && guestBtn && !guestBtn.contains(e.target) && !guestDropdown.contains(e.target)) {
                guestDropdown.classList.remove('show');
            }
        });
        
        // Dropdown menu functions
        function showMonitoredCompanies() {
            alert('Companies I Follow - Coming soon!');
            // TODO: Show modal with monitored companies list
        }
        
        function showSearchHistory() {
            // Navigate to dedicated search history page
            window.location.href = '/search-history.html';
        }
        
        // Sign out function
        async function signOut() {
            try {
                await supabaseClient.auth.signOut();
                currentUser = null;
                
                // Close all dropdown menus
                document.getElementById('userDropdown').classList.remove('show');
                document.getElementById('guestDropdown').classList.remove('show');
                
                updateAuthUI();
                showStatus('info', 'Signed out successfully');
            } catch (error) {
                console.error('Sign out error:', error);
                showStatus('error', 'Failed to sign out');
            }
        }
        
        // Debug function - type debugAuth() in console
        window.debugAuth = async function() {
            console.log('=== AUTH DEBUG ===');
            console.log('LocalStorage keys:', Object.keys(localStorage));
            console.log('docspace-auth:', localStorage.getItem('docspace-auth'));
            
            // Try to get session directly
            const { data: { session }, error } = await supabaseClient.auth.getSession();
            console.log('Direct session check:', session);
            console.log('Session error:', error);
            
            // Try to get user
            const { data: { user } } = await supabaseClient.auth.getUser();
            console.log('Current user:', user);
            
            console.log('=================');
        };
        
        // Sign out button handler (keeping this one for the separate sign out button if needed)
        const signOutBtn = document.getElementById('signOutBtn');
        if (signOutBtn) {
            signOutBtn.addEventListener('click', async () => {
                signOut();
            });
        }
        
        // Listen for auth state changes
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth state changed:', event, session);
            currentUser = session?.user || null;
            updateAuthUI();
            
            // Special handling for sign in
            if (event === 'SIGNED_IN' && session) {
                console.log('User signed in successfully:', session.user.email);
                currentUser = session.user;
                updateAuthUI();
            }
        });
        
        // Set up auth button immediately
        document.addEventListener('DOMContentLoaded', () => {
            const authBtn = document.getElementById('authBtn');
            if (authBtn) {
                authBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Check auth state at click time
                    const { data: { session } } = await supabaseClient.auth.getSession();
                    console.log('Click time auth check:', session);
                    
                    if (session?.user) {
                        console.log('Showing user menu for:', session.user.email);
                        showUserMenu();
                    } else {
                        console.log('Showing guest menu');
                        showGuestMenu();
                    }
                });
            }
        });
        
        // Check for payment status on page load
        window.addEventListener('DOMContentLoaded', async () => {
            // Wait a bit for Supabase to initialize
            await new Promise(resolve => setTimeout(resolve, 100));
            // First check if we're coming back from auth redirect
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            const urlParams = new URLSearchParams(window.location.search);
            const accessToken = hashParams.get('access_token') || urlParams.get('access_token');
            
            if (accessToken) {
                console.log('Found access token in URL, setting session...');
                
                // Try to manually handle the auth callback
                try {
                    // First let Supabase try to handle it automatically
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Check if session was created
                    const { data: { session: autoSession } } = await supabaseClient.auth.getSession();
                    
                    if (!autoSession) {
                        console.log('Auto session detection failed, trying manual exchange...');
                        // If no session, try to exchange the hash for a session
                        const refreshToken = hashParams.get('refresh_token') || urlParams.get('refresh_token');
                        const { data, error } = await supabaseClient.auth.setSession({
                            access_token: accessToken,
                            refresh_token: refreshToken
                        });
                        
                        if (error) {
                            console.error('Error setting session:', error);
                        } else if (data?.session) {
                            console.log('Session set manually:', data.session);
                            currentUser = data.session.user;
                            updateAuthUI();
                        }
                    } else {
                        console.log('Session detected automatically:', autoSession);
                        currentUser = autoSession.user;
                        updateAuthUI();
                    }
                } catch (error) {
                    console.error('Error handling auth callback:', error);
                }
                
                // Clean up the URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            
            // Check auth state after DOM is loaded
            await checkAuthState();
            
            // Force refresh session to ensure we have latest state
            const { data: refreshData, error: refreshError } = await supabaseClient.auth.refreshSession();
            if (refreshData?.session) {
                console.log('Session refreshed:', refreshData.session);
                currentUser = refreshData.session.user;
                updateAuthUI();
            }
            
            // Also try to recover session from storage
            const { data: sessionData } = await supabaseClient.auth.getSession();
            if (sessionData?.session) {
                console.log('Recovered session from storage:', sessionData.session);
                currentUser = sessionData.session.user;
                updateAuthUI();
            }
            
            // Check for search data from search history page
            const searchData = sessionStorage.getItem('searchData');
            if (searchData) {
                try {
                    const { companyNumber, companyName, autoDownload, paymentCompleted: paidAlready } = JSON.parse(searchData);
                    sessionStorage.removeItem('searchData'); // Clear it
                    
                    // If payment was already completed, set the flag
                    if (paidAlready) {
                        paymentCompleted = true;
                        console.log('Payment already completed, skipping payment step');
                    }
                    
                    // Fill in the search form
                    const companyInput = document.getElementById('companyName');
                    companyInput.value = companyName;
                    companyInput.dataset.companyNumber = companyNumber;
                    
                    // Trigger form submission
                    setTimeout(() => {
                        document.getElementById('searchForm').dispatchEvent(new Event('submit'));
                        
                        // If auto-download is requested, trigger download after search completes
                        if (autoDownload) {
                            setTimeout(() => {
                                const downloadBtn = document.getElementById('downloadZipBtn');
                                if (downloadBtn && !downloadBtn.disabled) {
                                    downloadBtn.click();
                                }
                            }, 3000);
                        }
                    }, 1000);
                } catch (error) {
                    console.error('Error processing search data:', error);
                }
            }
            
            // Check payment status using already declared urlParams
            const paymentStatus = urlParams.get('payment');
            
            if (paymentStatus === 'success') {
                const storedData = localStorage.getItem('pendingCompany');
                
                if (storedData) {
                    try {
                        const parsed = JSON.parse(storedData);
                        
                        // Check if this is from history page
                        if (parsed.fromHistory) {
                            // Mark payment as completed
                            paymentCompleted = true;
                            
                            // Redirect to search with the company details
                            sessionStorage.setItem('searchData', JSON.stringify({
                                companyNumber: parsed.companyNumber,
                                companyName: parsed.companyName,
                                autoDownload: true,
                                paymentCompleted: true  // Add this flag
                            }));
                            localStorage.removeItem('pendingCompany');
                            window.location.href = window.location.origin;
                            return;
                        }
                        
                        const { companyData: stored, allDocuments: docs, timestamp } = parsed;
                        
                        if (Date.now() - timestamp < 30 * 60 * 1000) {
                            companyData = stored;
                            allDocuments = docs;
                            paymentCompleted = true;
                            
                            console.log('Restoring after payment:', companyData, docs);
                            
                            // Ensure we have the right data
                            if (!companyData.title && companyData.company_name) {
                                companyData.title = companyData.company_name;
                            }
                            
                            displayCompanyInfo(companyData);
                            document.getElementById('totalDocs').textContent = docs.length;
                            // Company age should already be set from stored data
                            if (companyData.date_of_creation) {
                                const incorporationDate = new Date(companyData.date_of_creation);
                                const currentDate = new Date();
                                const ageInYears = Math.floor((currentDate - incorporationDate) / (365.25 * 24 * 60 * 60 * 1000));
                                document.getElementById('companyAge').textContent = ageInYears;
                            }
                            document.getElementById('resultsContainer').style.display = 'block';
                            
                            showStatus('success', 'Payment successful! Starting download...');
                            localStorage.removeItem('pendingCompany');
                            
                            console.log('Starting download in 1.5 seconds...');
                            setTimeout(async () => {
                                console.log('Starting download now...');
                                try {
                                    await startDownload();
                                } catch (error) {
                                    console.error('Download error:', error);
                                    showStatus('error', 'Download failed: ' + error.message);
                                }
                            }, 1500);
                        } else {
                            localStorage.removeItem('pendingCompany');
                            showStatus('error', 'Payment session expired. Please search again.');
                        }
                    } catch (error) {
                        showStatus('error', 'Error restoring session. Please search again.');
                    }
                } else {
                    showStatus('info', 'Payment successful! Please search for the company again to download.');
                }
                
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (paymentStatus === 'cancelled') {
                showStatus('info', 'Payment cancelled. Search for a company to try again.');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
        
        // Explore tab functions
        // Initialize with existing data first
        let oldestCompanies = [
            { name: "THE RYE CATTLE MARKET COMPANY LIMITED", number: "00001452", year: "1859", location: "Rye, East Sussex", status: "Active", industry: "AGRICULTURE" },
            { name: "THE ABERDEEN-ANGUS CATTLE SOCIETY", number: "SC000926", year: "1879", location: "Perth, Scotland", status: "Active", industry: "AGRICULTURE" },
            { name: "BLACK SEA AND BALTIC INSURANCE CO", number: "00204185", year: "1925", location: "London", status: "Active", industry: "FINANCIAL" },
            { name: "BRITISH WIDOWS FUND AND LIFE", number: "00000124", year: "1815", location: "Edinburgh", status: "Active", industry: "FINANCIAL" },
            { name: "LONDON ASSURANCE CORPORATION", number: "00000098", year: "1862", location: "London", status: "Active", industry: "FINANCIAL" }
        ];
        
        let newestCompanies = [
            { name: "TECH SOLUTIONS LIMITED", number: "15234567", year: "2024", location: "London", status: "Active", industry: "TECHNOLOGY" },
            { name: "RENEWABLE ENERGY UK LTD", number: "15234568", year: "2024", location: "Manchester", status: "Active", industry: "ENERGY" },
            { name: "DIGITAL SERVICES LIMITED", number: "15234569", year: "2024", location: "Cambridge", status: "Active", industry: "TECHNOLOGY" },
            { name: "MODERN FOODS COMPANY", number: "15234570", year: "2024", location: "Bristol", status: "Active", industry: "AGRICULTURE" },
            { name: "FINANCIAL TECH LTD", number: "15234571", year: "2024", location: "Edinburgh", status: "Active", industry: "FINANCIAL" }
        ];

        // Function to guess industry from SIC code
        function guessIndustryFromSIC(sicText) {
            if (!sicText) return 'OTHER';
            const sic = sicText.toUpperCase();
            
            // Agriculture & Food (01-03, 10-11)
            if (sic.startsWith('01') || sic.startsWith('02') || sic.startsWith('03') || 
                sic.startsWith('10') || sic.startsWith('11') || sic.includes('AGRICULTURE') || 
                sic.includes('FARM') || sic.includes('FOOD') || sic.includes('CATTLE')) {
                return 'AGRICULTURE';
            }
            
            // Financial (64-66)
            if (sic.startsWith('64') || sic.startsWith('65') || sic.startsWith('66') || 
                sic.includes('FINANC') || sic.includes('INSURANCE') || sic.includes('BANK')) {
                return 'FINANCIAL';
            }
            
            // Technology (62-63)
            if (sic.startsWith('62') || sic.startsWith('63') || sic.includes('SOFTWARE') || 
                sic.includes('COMPUTER') || sic.includes('INFORMATION')) {
                return 'TECHNOLOGY';
            }
            
            // Retail (45-47)
            if (sic.startsWith('45') || sic.startsWith('46') || sic.startsWith('47') || 
                sic.includes('RETAIL') || sic.includes('WHOLESALE') || sic.includes('SALE')) {
                return 'RETAIL';
            }
            
            // Manufacturing (10-33)
            if ((sic.match(/^\d{2}/) && parseInt(sic.substring(0, 2)) >= 10 && parseInt(sic.substring(0, 2)) <= 33) ||
                sic.includes('MANUFACTUR')) {
                return 'MANUFACTURING';
            }
            
            // Real Estate (68)
            if (sic.startsWith('68') || sic.includes('REAL ESTATE') || sic.includes('PROPERTY')) {
                return 'REAL_ESTATE';
            }
            
            // Energy (05-09, 35)
            if (sic.startsWith('05') || sic.startsWith('06') || sic.startsWith('07') || 
                sic.startsWith('08') || sic.startsWith('09') || sic.startsWith('35') || 
                sic.includes('ENERGY') || sic.includes('ELECTRIC') || sic.includes('GAS') || 
                sic.includes('MINING')) {
                return 'ENERGY';
            }
            
            // Healthcare (86-88)
            if (sic.startsWith('86') || sic.startsWith('87') || sic.startsWith('88') || 
                sic.includes('HEALTH') || sic.includes('MEDICAL') || sic.includes('HOSPITAL')) {
                return 'HEALTHCARE';
            }
            
            // Transportation (49-53)
            if (sic.startsWith('49') || sic.startsWith('50') || sic.startsWith('51') || 
                sic.startsWith('52') || sic.startsWith('53') || sic.includes('TRANSPORT')) {
                return 'TRANSPORT';
            }
            
            // Construction (41-43)
            if (sic.startsWith('41') || sic.startsWith('42') || sic.startsWith('43') || 
                sic.includes('CONSTRUCTION') || sic.includes('BUILDING')) {
                return 'CONSTRUCTION';
            }
            
            // Professional Services (69-75)
            if (sic.startsWith('69') || sic.startsWith('70') || sic.startsWith('71') || 
                sic.startsWith('72') || sic.startsWith('73') || sic.startsWith('74') || 
                sic.startsWith('75') || sic.includes('CONSULTING') || sic.includes('LEGAL')) {
                return 'SERVICES';
            }
            
            // Media & Entertainment (58-60, 90-93)
            if (sic.startsWith('58') || sic.startsWith('59') || sic.startsWith('60') || 
                sic.startsWith('90') || sic.startsWith('91') || sic.startsWith('92') || 
                sic.startsWith('93') || sic.includes('MEDIA') || sic.includes('BROADCAST') || 
                sic.includes('PUBLISHING') || sic.includes('ENTERTAINMENT')) {
                return 'MEDIA';
            }
            
            return 'OTHER';
        }
        
        // Function to guess industry from company name
        function guessIndustry(companyName) {
            const name = companyName.toUpperCase();
            
            // Agriculture & Food
            if (name.includes('CATTLE') || name.includes('FARM') || name.includes('AGRICULTURE') || 
                name.includes('FOOD') || name.includes('DAIRY') || name.includes('MEAT')) {
                return 'AGRICULTURE';
            }
            
            // Financial
            if (name.includes('INSURANCE') || name.includes('BANK') || name.includes('FINANCE') || 
                name.includes('INVESTMENT') || name.includes('FUND') || name.includes('CAPITAL') ||
                name.includes('HOLDINGS') || name.includes('ASSURANCE')) {
                return 'FINANCIAL';
            }
            
            // Technology
            if (name.includes('TECH') || name.includes('SOFTWARE') || name.includes('DIGITAL') || 
                name.includes('COMPUTER') || name.includes('IT ') || name.includes('DATA')) {
                return 'TECHNOLOGY';
            }
            
            // Property & Real Estate
            if (name.includes('PROPERTIES') || name.includes('PROPERTY') || name.includes('ESTATE') || 
                name.includes('LAND') || name.includes('DEVELOPMENT')) {
                return 'REAL_ESTATE';
            }
            
            // Construction
            if (name.includes('CONSTRUCTION') || name.includes('BUILDING') || name.includes('BUILDER')) {
                return 'CONSTRUCTION';
            }
            
            // Transport & Shipping
            if (name.includes('TRANSPORT') || name.includes('SHIPPING') || name.includes('NAVIGATION') || 
                name.includes('RAILWAY') || name.includes('LOGISTICS')) {
                return 'TRANSPORT';
            }
            
            // Energy & Utilities
            if (name.includes('GAS') || name.includes('ELECTRIC') || name.includes('ENERGY') || 
                name.includes('POWER') || name.includes('OIL') || name.includes('PETROLEUM')) {
                return 'ENERGY';
            }
            
            // Retail & Shops
            if (name.includes('RETAIL') || name.includes('SHOP') || name.includes('STORE') || 
                name.includes('TRADING') || name.includes('SALES')) {
                return 'RETAIL';
            }
            
            // Manufacturing
            if (name.includes('MANUFACTUR') || name.includes('FACTORY') || name.includes('PRODUCTION') || 
                name.includes('ENGINEERING')) {
                return 'MANUFACTURING';
            }
            
            // Healthcare
            if (name.includes('HEALTH') || name.includes('MEDICAL') || name.includes('CLINIC') || 
                name.includes('HOSPITAL') || name.includes('PHARMA') || name.includes('CARE')) {
                return 'HEALTHCARE';
            }
            
            // Professional Services
            if (name.includes('CONSULTING') || name.includes('SERVICES') || name.includes('SOLUTIONS') || 
                name.includes('LEGAL') || name.includes('ACCOUNTAN') || name.includes('MANAGEMENT')) {
                return 'SERVICES';
            }
            
            // Media & Publishing
            if (name.includes('NEWSPAPER') || name.includes('MEDIA') || name.includes('PUBLISHING') || 
                name.includes('BROADCAST') || name.includes('PRESS')) {
                return 'MEDIA';
            }
            
            return 'OTHER';
        }

        // Fetch real data from Railway and replace the mock data
        function loadRealCompanies() {
            console.log(`Loading real companies from Railway (${currentView})...`);
            
            const industryFilter = document.getElementById('industryFilter') ? document.getElementById('industryFilter').value : 'ALL';
            const industryParam = industryFilter !== 'ALL' ? `?industry=${industryFilter}` : '';
            
            const endpoint = currentView === 'oldest' 
                ? `https://companies-api-production-68c2.up.railway.app/api/oldest${industryParam}`
                : `https://companies-api-production-68c2.up.railway.app/api/newest${industryParam}`;
            
            fetch(endpoint)
                .then(r => r.json())
                .then(data => {
                    console.log(`${currentView} companies data:`, data);
                    if (data && Array.isArray(data) && data.length > 0) {
                        const companies = data.map(company => {
                            // Extract year from IncorporationDate
                            let year = 'Unknown';
                            if (company.IncorporationDate) {
                                const date = new Date(company.IncorporationDate);
                                year = date.getFullYear().toString();
                            }
                            
                            // Get location from address fields
                            let location = company.RegAddress_PostTown || 
                                          company.RegAddress_County || 
                                          company.RegAddress_Country || 
                                          'United Kingdom';
                            
                            // Determine industry from SIC codes or company name
                            let industry = 'OTHER';
                            if (company.SICCode_SicText_1) {
                                industry = guessIndustryFromSIC(company.SICCode_SicText_1);
                            } else {
                                industry = guessIndustry(company.CompanyName);
                            }
                            
                            return {
                                name: company.CompanyName,
                                number: company.CompanyNumber,
                                year: year,
                                location: location,
                                status: company.CompanyStatus,
                                industry: industry
                            };
                        });
                        
                        // Assign to the correct array based on current view
                        if (currentView === 'oldest') {
                            oldestCompanies = companies;
                            console.log('Updated oldestCompanies:', oldestCompanies);
                        } else {
                            newestCompanies = companies;
                            console.log('Updated newestCompanies:', newestCompanies);
                        }
                        
                        if (document.getElementById('exploreTab').classList.contains('active')) {
                            renderCompanies();
                        }
                    }
                })
                .catch(err => console.error(`Error loading ${currentView} companies:`, err));
        }

        // Load real data when page loads
        setTimeout(loadRealCompanies, 1000);

        
        let currentView = 'oldest';
        
        function onIndustryChange() {
            companiesOffset = 5; // Reset offset when industry changes
            loadRealCompanies(); // Reload data with new filter
        }
        
        function showOldest() {
            currentView = 'oldest';
            companiesOffset = 5; // Reset offset
            document.getElementById('oldestBtn').classList.add('active');
            document.getElementById('newestBtn').classList.remove('active');
            document.querySelector('.show-more-btn').style.display = 'block'; // Show button again
            loadRealCompanies(); // Load data with current industry filter
        }
        
        function showNewest() {
            currentView = 'newest';
            companiesOffset = 5; // Reset offset
            document.getElementById('newestBtn').classList.add('active');
            document.getElementById('oldestBtn').classList.remove('active');
            document.querySelector('.show-more-btn').style.display = 'block'; // Show button again
            loadRealCompanies(); // Load data with current industry filter
        }
        
        function toggleActive(element) {
            element.classList.toggle('active');
            renderCompanies();
        }
        
        function renderCompanies() {
            const list = document.getElementById('companyListExplore');
            if (!list) return;
            
            const activeOnly = document.getElementById('activeSwitch') && document.getElementById('activeSwitch').classList.contains('active');
            const industryFilter = document.getElementById('industryFilter') ? document.getElementById('industryFilter').value : 'ALL';
            const companies = currentView === 'oldest' ? oldestCompanies : newestCompanies;
            
            // Apply filters
            let filtered = companies;
            
            // Filter by active status only (industry filtering is done server-side)
            if (activeOnly) {
                filtered = filtered.filter(c => c.status === 'Active');
            }
            
            list.innerHTML = filtered.map(company => `
                <div class="explore-company-card" onclick="selectExploreCompany('${company.number}')">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #ffffff; display: flex; align-items: center;">
                        <span class="status-indicator status-${company.status.toLowerCase()}" data-tooltip="${company.status}"></span>
                        ${company.name}
                    </div>
                    <div style="color: #94a3b8; font-size: 14px; display: flex; align-items: center;">
                        ${company.year} • ${company.location} • ${company.number}
                        <span class="industry-badge industry-${company.industry.toLowerCase().replace(/[\s_]/g, '_')}">${company.industry.replace(/_/g, ' ')}</span>
                    </div>
                </div>
            `).join('');
            
            // If no companies after filter, show message
            if (filtered.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 40px;">No companies found with current filters</div>';
            }
        }
        
        function selectExploreCompany(companyNumber) {
            document.getElementById('searchQuery').value = companyNumber;
            document.getElementById('tab-bulk').click();
            searchCompany();
        }
        
        let companiesOffset = 5; // Start at 5 since we already loaded first 5
        
        // Get current user helper
        async function getCurrentUser() {
            if (typeof supabaseClient === 'undefined') return null;
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                return user;
            } catch (error) {
                return null;
            }
        }
        
        async function loadMore() {
            const user = await getCurrentUser();
            
            if (!user) {
                // Redirect to auth page
                window.location.href = '/auth.html';
                return;
            }
            
            // For logged-in users, load more companies
            const industryFilter = document.getElementById('industryFilter') ? document.getElementById('industryFilter').value : 'ALL';
            const industryParam = industryFilter !== 'ALL' ? `?industry=${industryFilter}` : '';
            
            const endpoint = currentView === 'oldest' 
                ? `https://companies-api-production-68c2.up.railway.app/api/oldest/${companiesOffset}${industryParam}`
                : `https://companies-api-production-68c2.up.railway.app/api/newest/${companiesOffset}${industryParam}`;
                
            fetch(endpoint)
                .then(r => r.json())
                .then(data => {
                    if (data && Array.isArray(data) && data.length > 0) {
                        const companies = currentView === 'oldest' ? oldestCompanies : newestCompanies;
                        
                        data.forEach(company => {
                            // Extract year from IncorporationDate
                            let year = 'Unknown';
                            if (company.IncorporationDate) {
                                const date = new Date(company.IncorporationDate);
                                year = date.getFullYear().toString();
                            }
                            
                            // Get location from address fields
                            let location = company.RegAddress_PostTown || 
                                          company.RegAddress_County || 
                                          company.RegAddress_Country || 
                                          'United Kingdom';
                            
                            // Determine industry from SIC codes or company name
                            let industry = 'OTHER';
                            if (company.SICCode_SicText_1) {
                                industry = guessIndustryFromSIC(company.SICCode_SicText_1);
                            } else {
                                industry = guessIndustry(company.CompanyName);
                            }
                            
                            companies.push({
                                name: company.CompanyName,
                                number: company.CompanyNumber,
                                year: year,
                                location: location,
                                status: company.CompanyStatus,
                                industry: industry
                            });
                        });
                        
                        companiesOffset += 5;
                        renderCompanies();
                        
                        if (data.length < 5) {
                            // No more companies to load
                            document.querySelector('.show-more-btn').style.display = 'none';
                        }
                    }
                })
                .catch(err => console.error('Error loading more companies:', err));
        }
        
        // Update load more button text based on auth state
        async function updateLoadMoreButton() {
            const user = await getCurrentUser();
            const btn = document.getElementById('loadMoreBtn');
            if (btn) {
                btn.textContent = user ? 'Load More' : 'Create Account for More';
            }
        }
        
        // Initial render on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load real companies from Railway database
            loadRealCompanies();
            
            // Check if explore tab is initially active and render companies
            if (document.getElementById('exploreTab') && document.getElementById('exploreTab').classList.contains('active')) {
                renderCompanies();
            }
            // Update button text
            updateLoadMoreButton();
        });
        
        // Also update button when auth state changes
        window.addEventListener('authStateChanged', updateLoadMoreButton);
    </script>
</body>
</html>
<!-- Deploy trigger: Wed May 28 09:45:00 2025 -->